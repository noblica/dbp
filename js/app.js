!function(){"use strict";angular.module("test",[])}(),function(){"use strict";function e(e,t){function r(e){e.go("app.home")}e.state("app",{"abstract":!0,controller:"AppController",controllerAs:"app",template:"<ui-view></ui-view>"}).state("app.home",{url:"",controller:"TestController",controllerAs:"vm",templateUrl:"app/TestModule/test.html"}),t.when("",r).when("/",r).otherwise("/error/404"),r.$inject=["$state"]}angular.module("app",["ui.router","ui.bootstrap","ngAnimate","core","pipeline","test"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("core",[])}(),function(){"use strict";angular.module("pipeline",[])}(),function(){"use strict";function e(e){function t(){}function r(e){n.localHistoryCollapse=!n.localHistoryCollapse}var n=this;n.corelationRegisterCollapse=!1,n.localHistoryCollapse=!0,n.predictionMachinesCollapse=!0,n.predictionMachinesService=e,n.toggleLocalHistory=r,t()}angular.module("test").controller("TestController",e),e.$inject=["predictionMachinesService"]}(),function(){"use strict";function e(){function e(){console.log("Layout controller loaded!")}e()}angular.module("app").controller("AppController",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r){function n(){p.flags={ZF:!1,CF:!1,OF:!1,SF:!1}}function i(n,i){isNaN(n)&&(p.aRegName=n),p.a=r.getValueFromSpeculative(n),null===p.a&&(p.a=t.getValueOfReg(n)),null===p.a&&(p.a=e.getValueOfReg(n)),p.b=void 0!==Number(i)?Number(i):p.b,isNaN(p.b)&&(p.bRegName=i,p.b=r.getValueFromSpeculative(i),null===p.b&&(p.b=t.getValueOfReg(i)),null===p.b&&(p.b=e.getValueOfReg(i)))}function o(e,t,r){function n(){return C=p.b}function o(){return C=p.a+p.b,s(!1),d(!1),Math.abs(C)>p.maxValue&&(s(!0),C=a(C)),R=u(C),c(O,y,R)&&d(!0),C}function v(){return s(!1),d(!1),l(!1),C=a(p.a-p.b),p.b>p.a&&s(!0),p.b===p.a&&l(!0),R=u(C),c(O,y,R)&&d(!0),C}function h(){return s(!1),d(!1),l(!1),C=p.a*p.b,0===C&&l(!0),Math.abs(C)>p.maxValue&&(s(!0),C=a(C)),R=u(C),c(O,y,R)&&d(!0),C}function m(){return d(!1),C=Math.floor(p.a/p.b),R===1/0&&d(!0),C}function g(){return C=p.a&p.b,f(!!u(C)),C}function b(){return C=p.a|p.b,f(!!u(C)),C}function I(){return C=p.a^p.b,f(!!u(C)),C}function S(){return l(!1),f(!1),C=p.a&p.b,0===C&&l(!0),f(!!u(C)),C}function P(){return C=~p.a}function M(){console.log("end reached!")}i(e,t);var C=p.cmpResult,O=u(p.a),y=u(p.b),R=null,x={mov:n,add:o,sub:v,cmp:v,mul:h,div:m,and:g,or:b,xor:I,test:S,not:P,end:M};return p.cmpResult=x[r](),p.cmpResult}function c(e,t,r){return e===t&&r!==e}function u(e){var t=p.bitSize,r=a(e),n=r.toString(2),i=Number(n.split("").reverse()[t]);return i?i:0}function a(e){return Number(e)&p.maxValue}function l(e){return p.flags.ZF=void 0===e?0===p.cmpResult:e,p.flags}function s(e){return p.flags.CF=void 0===e?p.flags.CF:e,p.flags}function d(e){return p.flags.OF=e,void 0===e&&(p.flags.OF=void 0===e?p.flags.OF:e),p.flags}function f(e){return p.flags.SF=e||p.cmpResult<0||p.cmpResult>p.maxValue,p.flags}var p={flags:{ZF:!1,CF:!1,OF:!1,SF:!1},a:0,aRegName:"",b:0,bRegName:"",cmpResult:0,maxValue:Math.pow(2,16)-1,maxValueSigned:Math.pow(2,15)-1,bitSize:15,compareAndSetFlags:o,resetFlags:n};return p}angular.module("app").factory("aluService",e),e.$inject=["registerService","WBService","speculativeService"]}(),function(){"use strict";function e(e,t,r,n,i,o,c,u,a,l,s,d,f,p,v,h,m,g){function b(e){var t=e.split("\n"),r=C(t);f.initialize(),x.codeArray=a.setAndRemoveLabelsFromCodeArray(r),s.pipelineStarted=!0,s.predictionEventFlag=!1,l.pc=-1,s.forceStop=!1,c.endReached=!1,v.resetFlags(),s.currentPredictionState=h.predicting,l.setNewPc(),y(l.pc,x.codeArray)}function I(e){var t={1:function(e){1!==x.previousState&&(d.blinkMe(null),x.previousState=1,g.alert("Going to the next jump instruction")),S(e)},2:function(){2!==x.previousState&&(x.previousState=2,g.alert("Undoing mispredictions, one by one")),d.restorePredictions()},3:function(){3!==x.previousState&&(x.previousState=3,g.alert("Commiting the misprediction")),d.commitMisprediction(),d.setNewPredictionState()},4:function(){4!==x.previousState&&(x.previousState=4,g.alert("Commiting the correctly made predictions")),d.commitCorrectPredictions()}};t[s.currentPredictionState](e)}function S(e){do O(l.pc,e);while(!M(e)&&!P()&&!s.predictionEventFlag);s.predictionEventFlag=!1,d.setNewPredictionState(),M(e)&&(s.removePredictedClassOnEnd(),s.resetLastChangedIndexes(),m.clear(),s.pipelineStarted=!1,s.pipelineActive=!1,g.alert("Finished!"))}function P(){return o.instructionsInEX.some(function(e){return p.isJmpInstruction(e.operation)||p.isFlagGenInstruction(e.operation)})}function M(e){var t=s.isPipelineEmpty(),r=d.noMoreUncomitted(),n=!l.overridePc,i=s.forceStop;return t&&r&&n||i}function C(e){var t=e.filter(function(e){return""!==e});return t}function O(e,t,r){R(),l.setNewPc(),y(l.pc,t,r)}function y(t,n,o){e.parse(t,n,1),r.parse(),i.parse(),c.parse()}function R(){c.pipeThrough(),i.pipeThrough(),r.pipeThrough(),e.pipeThrough()}var x=this;x.codeInput="mov ax, 0\nmov bx, 3\nmov cx, 5\nloop-l1:\nadd ax, 1\nmov dx, 0\nloop-l2:\nadd dx, ax\nmov ex, dx\ndiv ex, 2\ncmp ex, 0\nje l3\ncmp dx, cx\njl loop-l2\nl3: \nadd cx, ax\ncmp ax, bx\njl loop-l1\nend",x.codeArray=[],x.pipelineStarted=!1,x.endReached=!1,x.trapFlag=!1,x.loopCounter=m.counter,x.IFModel=t,x.IDModel=n,x.EXModel=o,x.WBModel=u,x.common=s,x.previousState=-1,x.doPrediction=b,x.goToNextBranchInstruction=I}angular.module("app").controller("CodeInputController",e),e.$inject=["IFService","IFModel","IDService","IDModel","EXService","EXModel","WBService","WBModel","labelService","pcService","common","speculativeService","speculativeModel","jmpInstructionService","aluService","allPredictorStates","loopCounterService","$window"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CodeInputController",controllerAs:"ci",templateUrl:"app/codeInput/code-input.html"};return e}angular.module("app").directive("codeInput",e),e.$inject=[]}(),function(){"use strict";function e(e){function t(e){var t={name:e,count:1};a.counter.push(t)}function r(e){var t=null;return a.counter.some(function(r,n){if(r.name===e)return t=n,!0}),t}function n(e,t){var r={1:function(e){return e+1},0:function(e){return 0}},n=a.counter[e].count;a.counter[e].count=r[t](n),0===a.counter[e].count&&a.counter.splice(e,1)}function i(e,t){var r=a.checkIfLoop(e),n=null;null!==r&&(n=a.getLoopIndex(r),null!==n?a.updateLoopCount(n,t):1===t&&a.createCounter(r))}function o(t){var r=e.getLabelName(t),n=null;return null!==r&&(n=c(r)),n}function c(e){var t="loop-",r=null;return e.substring(0,5)===t&&(r=e.substring(5)),r}function u(){a.counter.splice(0,a.counter.length)}var a={counter:[],createCounter:t,getLoopIndex:r,updateLoopCount:n,checkAndHandleLoopLabelPc:i,checkIfLoop:o,clear:u};return a}angular.module("app").factory("loopCounterService",e),e.$inject=["labelService"]}(),function(){"use strict";function e(e,t,r,n,i,o,c,u){function a(i,o,c,u){void 0===i?(e.flush(),t.flush(),r.flush(),n.flush()):(i&&e.flush(),o&&t.flush(),c&&r.flush(),u&&n.flush())}function l(){return 0===e.instructionsInIF.length&&0===t.instructionsInID.length&&0===r.instructionsInEX.length&&0===n.instructionsInWB.length}function s(e){var t=null!==e.firstOperator,r=null!==e.secondOperator;return e.operation+" "+(t?e.firstOperator:"")+(r?", "+e.secondOperator:"")}function d(){i.lastChangedIndex=null,o.lastChangedIndex=null,c.lastChangedIndex=null,u.lastChangedIndex=null}function f(){p(c.value),p(u.value)}function p(e){return e.map(function(e){return e.predicted=!1,e}),e}var v={pipelineStarted:!1,pipelineActive:!1,removingMispredctions:!1,currentPredictionState:null,flushPipeline:a,isPipelineEmpty:l,instructionToText:s,predictionEventFlag:!1,removePredictedClassOnEnd:f,resetLastChangedIndexes:d};return v}angular.module("core").factory("common",e),e.$inject=["IFModel","IDModel","EXModel","WBModel","corelationRegisterService","speculativeModel","localHistoryTableService","predictionMachinesService"]}(),function(){"use strict";var e={predicting:1,undoMisprediction:2,commitMisprediction:3,commitCorrectPrediction:4};angular.module("core").constant("allPredictorStates",e)}(),function(){"use strict";function e(e){function t(){o.jmpInstructions=["jmp","je","jz","jne","jnz","jg","jnle","jge","jnl","jl","jnge","jle","jng"],o.flagGenInstructions=["test","cmp"]}function r(e){return o.jmpInstructions.indexOf(e)!==-1}function n(e){return o.flagGenInstructions.indexOf(e)!==-1}function i(t){var r=e.flags,n={jmp:!0,je:r.ZF,jz:r.ZF,jne:!r.ZF,jnz:!r.ZF,jg:!r.ZF&&r.SF===r.OF,jnle:!r.ZF&&r.SF===r.OF,jge:r.SF===r.OF,jnl:r.SF===r.OF,jl:r.SF!==r.OF,jnge:r.SF!==r.OF,jle:r.ZF||r.SF!==r.OF,jng:r.ZF||r.SF!==r.OF};return n[t]}var o={jmpInstructions:[],isJmpInstruction:r,isFlagGenInstruction:n,checkBranchCondition:i};return t(),o}angular.module("core").factory("jmpInstructionService",e),e.$inject=["aluService"]}(),function(){"use strict";function e(){function e(e,t){var r={};r[e.toLowerCase()]=t,i.labelArray.push(r)}function t(e){var t=null;return i.labelArray.some(function(r){if(void 0!==r[e])return t=r,!0}),t[e]}function r(e){var t=null;return i.labelArray.some(function(r){for(var n in r)r.hasOwnProperty(n)&&r[n]===e&&(t=n)}),t}function n(t){for(var r=t,n=0;n<t.length;){var i=t[n];if(i.indexOf(":")!==-1){var o=i.slice(0,i.indexOf(":"));r.splice(n,1),e(o,n)}else n++}return r}var i={labelArray:[],getAddress:t,getLabelName:r,setLabelAddress:e,setAndRemoveLabelsFromCodeArray:n};return i}angular.module("core").factory("labelService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){t.pc+=1,null!==t.overridePc&&(t.pc=t.overridePc,t.overridePc=null)}var t={pc:-1,branchesPredictedTaken:[],overridePc:null,setNewPc:e};return t}angular.module("core").factory("pcService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){t.currentPc=0,t.instructionsInEX=[],t.writeBackResults=[];var e={currentPc:t.currentPc,instructionSet:t.instructionsInEX,writeBackResults:t.writeBackResults};t.returnPromise.resolve(e)}var t={currentPc:null,returnPromise:null,nextPredictionFalse:!1,instructionsInEX:[],writeBackResults:[],flush:e};return t}angular.module("core").factory("EXModel",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r,n,i,o,c,u,a,l,s,d,f,p,v,h,m){function g(t){return o.writeBackResults=[],C(o.instructionsInEX),P(),o.returnPromise=e.defer(),o.returnPromise.promise}function b(e,t){var c=r.checkBranchCondition(e.operation),u=n.getAddress(e.firstOperator),a=o.currentPc+t,v=(i.branchesPredictedTaken.indexOf(a),M()),m=d.getCurrentPrediction(a),g={pc:a,jmpToPc:u,delay:v,predictedValue:m?1:0,calculatedValue:c?1:0,state:h.speculative,blinkMe:!0},b=f.useCor,I=p.useLht,S=[],P={};if(b){var C=f.getCopy();S=S.concat(C)}if(I){var O=a,y=p.getLocalHistoryArray(O);S=S.concat(y),P.localHistoryIndex=O,P.localHistoryArray=y}S=parseInt(S.join(""),2);var R=d.getCopyOfMachine(S);P.predictionMachineIndex=S,P.predictionMachineValue=R,s.createNewBranchBuffer(g,P),l.limitWasReached||d.updatePredictionsExceptCorelation(g.predictedValue,g.pc,P,g),l.addingToSpeculative=!0}function I(e){var t=e.branchInfo.predictedValue,r=e.branchInfo.calculatedValue,n=e.branchInfo.pc,c=i.branchesPredictedTaken.indexOf(n);if(e.branchInfo.state=h.calculated,o.nextPredictionFalse&&(r=!r),r&&!t)return e.branchInfo.state=h.mispredicted,e.branchInfo.mispredictionPc=e.branchInfo.jmpToPc,e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0;if(r&&t)i.branchesPredictedTaken.splice(c,1),e.branchInfo.shouldCommit=!0;else if(r||t){if(!r&&t)return e.branchInfo.state=h.mispredicted,e.branchInfo.mispredictionPc=n+1,i.branchesPredictedTaken.splice(c,1),e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0}else e.branchInfo.shouldCommit=!0;return!1}function S(e){o.writeBackResults=y(e)}function P(){l.buffer.map(function(e,t){return e.branchInfo.delay&&(e.branchInfo.delay-=1,0===e.branchInfo.delay&&(s.blinkMe(t),I(e),a.predictionEventFlag=!0)),e}),s.noMoreUncomitted()&&(l.addingToSpeculative=!1)}function M(){return m.floor(40*m.random()+4)}function C(e){return e.some(function(e,t){var n=e.operation,i=r.isJmpInstruction(n),o=r.isFlagGenInstruction(n);if((i||o)&&(a.predictionEventFlag=!0),i){var c=b(e,t);return c}S(e)}),o.instructionsInEX}function O(){if(o.returnPromise){var t={currentPc:o.currentPc,instructionSet:o.instructionsInEX,writeBackResults:o.writeBackResults};return o.returnPromise.resolve(t),c.currentPc=t.currentPc,c.instructionsInWB=t.instructionSet,c.writeBackResults=t.writeBackResults,o.returnPromise.promise}return e.resolve()}function y(e){var r=e.firstOperator,n=e.secondOperator,i=e.operation,c=t.compareAndSetFlags(r,n,i),a={currentPc:o.currentPc,register:e.firstOperator,result:c,operation:i};return l.addingToSpeculative?u.shouldWriteBack(i)&&!l.limitWasReached&&s.addTo(r,c):o.writeBackResults.push(a),o.writeBackResults}var R={parse:g,pipeThrough:O,parseJumpInstruction:b};return R}angular.module("core").factory("EXService",e),e.$inject=["$q","aluService","jmpInstructionService","labelService","pcService","EXModel","WBModel","WBService","common","speculativeModel","speculativeService","predictionMachinesService","corelationRegisterService","localHistoryTableService","loopCounterService","speculativeStates","Math"]}(),function(){"use strict";function e(){function e(){t.currentPc=0,t.instructionsInID=[];var e={currentPc:t.currentPc,instructionSet:t.instructionsInID};t.returnPromise.resolve(e)}var t={currentPc:null,returnPromise:null,instructionsInID:[],flush:e};return t}angular.module("core").factory("IDModel",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r){function n(r){return t.instructionsInID=c(t.instructionsInID),t.returnPromise=e.defer(),t.returnPromise.promise}function i(){if(t.returnPromise){var n={currentPc:t.currentPc,instructionSet:t.instructionsInID};return t.returnPromise.resolve(n),r.currentPc=n.currentPc,r.instructionsInEX=n.instructionSet,t.returnPromise.promise}return e.resolve()}function o(e){var t=e.replace(",",""),r=t.split(" "),n={operation:r[0].toLowerCase(),firstOperator:void 0===r[1]?null:r[1].toLowerCase(),secondOperator:void 0===r[2]?null:r[2].toLowerCase()};return n}function c(e){var t=[];return e.forEach(function(e){var r=o(e);t.push(r)}),t}var u={parse:n,pipeThrough:i,decodeSingleInstruction:o};return u}angular.module("core").factory("IDService",e),e.$inject=["$q","IDModel","EXModel"]}(),function(){"use strict";function e(){function e(){t.currentPc=0,t.instructionsInIF=[];var e={currentPc:t.currentPc,instructionSet:t.instructionsInIF};t.returnPromise.resolve(e)}var t={currentPc:null,returnPromise:null,instructionsInIF:[],flush:e};return t}angular.module("core").factory("IFModel",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r,n,i,o,c,u,a){function l(r,n,i){t.currentPc=r||0,i=i||1,t.returnPromise=e.defer();var o=t.currentPc,c=t.currentPc+i;v.codeArrayInput=angular.copy(n);var u=n.slice(o,c);return s(u),t.instructionsInIF=u,a.checkAndHandleLoopLabelPc(r,1),t.returnPromise.promise}function s(e){for(var r=0;r<e.length;){var o=e[r],a=n.decodeSingleInstruction(o),l=r+t.currentPc,s=i.isJmpInstruction(a.operation),p=u.getCurrentPrediction(l)?1:0;if(s&&p){var v=e.length-r-1,h=f(a);if(v>0){var m=d(h,v);e.splice(r,v),e.concat(m)}c.branchesPredictedTaken.push(l),c.overridePc=h+v}r++}return e}function d(e,t){var r=e+t;return v.codeArrayInput.slice(e,r)}function f(e){var t=e.firstOperator;return o.getAddress(t)}function p(){if(t.returnPromise){var n={currentPc:t.currentPc,instructionSet:t.instructionsInIF};return t.returnPromise.resolve(n),r.currentPc=n.currentPc,r.instructionsInID=n.instructionSet,t.returnPromise.promise}return e.resolve()}var v={currentPc:null,returnPromise:null,instructionsInIF:[],codeArrayInput:[],parse:l,pipeThrough:p};return v}angular.module("core").factory("IFService",e),e.$inject=["$q","IFModel","IDModel","IDService","jmpInstructionService","labelService","pcService","predictionMachinesService","loopCounterService"]}(),function(){"use strict";function e(){function e(){t.currentPc=0,t.instructionsInWB=[],t.writeBackResults=[],t.returnPromise.resolve()}var t={currentPc:null,returnPromise:null,instructionsInWB:[],writeBackResults:[],flush:e};return t}angular.module("core").factory("WBModel",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r){function n(e){return i(r.writeBackResults),r.returnPromise=t.defer(),r.returnPromise.promise}function i(t){t.forEach(function(t){var r=t.register,n=t.result,i=t.operation;"end"===i&&(s.endReached=!0),c(i)&&e.setValueOfReg(r,n)})}function o(e){r.writeBackResults=r.writeBackResults.filter(function(t){return t.register!==e})}function c(e){return l.indexOf(e)===-1}function u(){return r.returnPromise?(r.returnPromise.resolve(r.writeBackResults),r.returnPromise.promise):t.resolve()}function a(e){var t=null;return r.writeBackResults.some(function(r){if(e===r.register)return t=r.result,!0}),t}var l=["cmp","end"],s={endReached:!1,parse:n,pipeThrough:u,shouldWriteBack:c,getValueOfReg:a,removeFromWriteback:o};return s}angular.module("core").factory("WBService",e),e.$inject=["registerService","$q","WBModel"]}(),function(){"use strict";angular.module("core").constant("Math",window.Math)}(),function(){"use strict";function e(e){function t(e){var t=0;return void 0!==n.coreRegisters[e]?t=n.coreRegisters[e]:void 0!==n.otherRegisters[e]?t=n.otherRegisters[e]:n.otherRegisters[e]=0,t}function r(e,t){return void 0!==n.coreRegisters[e]?n.coreRegisters[e]=t:n.otherRegisters[e]=t,e}var n={coreRegisters:{ax:0,bx:0,cx:0,dx:0,sp:0,bp:0,si:0,di:0},otherRegisters:{},getValueOfReg:t,setValueOfReg:r};return n}angular.module("core").factory("registerService",e),e.$inject=["speculativeModel"]}(),function(){"use strict";var e={speculative:0,calculated:1,mispredicted:2,committed:3,mispredictionCalculated:4};angular.module("core").constant("speculativeStates",e)}(),function(){"use strict";function e(){function e(e){i.size=e||i.size,t(i.size)}function t(e){i.buffer=[];for(var t=0;t<e;t++)i.buffer[t]={branchInfo:{predictedValue:0},valuesToCommit:{},predictionOverrides:{}}}function r(e){i.buffer.shift(),i.buffer.push(e)}function n(e){var t=[];return e.forEach(function(e){t.push(e.branchInfo.predictedValue)}),t}var i={addingToSpeculative:!1,buffer:[],size:8,speculativeSize:6,lastChangeIndex:null,initialize:e,setMaxNumberOfBits:t,shiftWithValue:r,formPredictedArray:n,limitWasReached:!1};return i}angular.module("core").factory("speculativeModel",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r,n,i,o,c,u,a,l,s,d,f){function p(){return 0===t.buffer.length}function v(){var e=[void 0,s.committed];return!t.buffer.some(function(t){return e.indexOf(t.branchInfo.state)===-1})}function h(){t.buffer=[]}function m(e,r){var n={branchInfo:e,valuesToCommit:{},predictionOverrides:r};return O(n),t.buffer[t.buffer.length-1]}function g(e,r){var n=t.buffer.length-1;t.buffer[n].valuesToCommit[e]=r}function b(){var e=t.buffer,r=[s.calculated];return e.some(function(e,t,n){var i=n[t-1];return r.indexOf(e.branchInfo.state)!==-1&&(!i||void 0===i.branchInfo.state||i.branchInfo.state===s.committed)})}function I(e){r.pushedOut.map(function(e){return e.branchInfo.blinkMe=!1,e}),t.buffer.map(function(t,r){t.branchInfo.blinkMe=!1,e===r&&(t.branchInfo.blinkMe=!0)})}function S(){var e=t.buffer,r=null;return e.some(function(e,t){if(e.branchInfo.state===s.calculated&&P(t))return r=e,!0}),r}function P(e){if(0===e)return!0;var r=e-1,n=t.buffer[r];return!n||void 0===n.branchInfo.state||n.branchInfo.state===s.committed}function M(){var e=t.buffer,n=S();if(n){var i=e.indexOf(n);n.branchInfo.state=s.committed;var o=n.branchInfo.calculatedValue;n.predictionOverrides;r.useCor&&r.value.push(o),n.branchInfo.shouldCommit&&B(n),I(i),r.lastChangedIndex=r.value.length-1,t.limitWasReached&&(f.alert("Predictions no longer at the limit. New predictions can now be pushed."),t.limitWasReached=!1,c.predictionEventFlag=!0)}else f.alert("No more predictions to commit!"),I(null),x(),r.lastChangedIndex=null}function C(){var e=t.buffer,r=t.speculativeSize,n=0;return e.reverse(),e.some(function(e){return void 0===e.branchInfo.state||e.branchInfo.state===s.committed||void n++}),e.reverse(),n<r}function O(e){t.buffer.length;if(C()){if(r.lastChangedIndex=null,t.buffer.push(e),I(t.buffer.length-1),r.useCor){var n=t.buffer.shift();r.pushedOut.shift(),r.pushedOut.push(n)}}else f.alert("Unable to push prediction, because prediction limit has been reached."),t.limitWasReached=!0,c.predictionEventFlag=!0}function y(){var e=t.buffer,r=z.mispredictedInfo.mispredicted,n=null,i=null;n=e[e.length-1],n&&n!==r?(I(null),n.branchInfo.state=null,i=n.predictionOverrides.localHistoryIndex,R(n),T(),e.pop(),I(e.length-1)):(R(r,!0),c.currentPredictionState=u.commitMisprediction,I(null),f.alert("Finished misprediction recovery."))}function R(e,t){var r=e.predictionOverrides.predictionMachineIndex,o=e.predictionOverrides.predictionMachineValue,c=e.branchInfo.jmpToPc,u=n.useLht;if(!t&&u){var l=e.predictionOverrides.localHistoryIndex,s=e.predictionOverrides.localHistoryArray;n.restoreFromOverride(l,s),n.lastChangedIndex=l}i.setPrediction(r,o),i.lastChangedIndex=r,a.checkAndHandleLoopLabelPc(c,e.branchInfo.calculatedValue)}function x(){t.buffer;c.currentPredictionState=u.predicting,z.mispredictedInfo=F(),null!==z.mispredictedInfo.mispredictedIndex?c.currentPredictionState=u.undoMisprediction:b()&&(c.currentPredictionState=u.commitCorrectPrediction)}function F(){var e=t.buffer,r={mispredictedIndex:null,updateWith:null,pcToUse:0,predictionOverrides:{}};return e.some(function(e,t,n){if(e.branchInfo.state===s.mispredicted&&P(t))return r={updateWith:e.branchInfo.calculatedValue,mispredictedIndex:t,mispredicted:e,pcToUse:e.branchInfo.pc,predictionOverrides:e.predictionOverrides},!0}),r}function j(){var e=t.buffer,r=z.mispredictedInfo,n=r.mispredicted,u=n.branchInfo,a=e.indexOf(n),l=r.updateWith,d=r.pcToUse,p=r.predictionOverrides;n.branchInfo;return n.valuesToCommit={},I(a),null!==a&&(i.updatePredictionsExceptCorelation(l,d,p),c.flushPipeline(),o.overridePc=u.mispredictionPc,n.branchInfo.state=s.committed),t.limitWasReached&&(f.alert("Predictions no longer at the limit. New predictions can now be pushed."),t.limitWasReached=!1,c.predictionEventFlag=!0),e}function T(){var e={branchInfo:{predictedValue:0},valuesToCommit:{}},n=r.pushedOut.pop();r.pushedOut.unshift(e),t.buffer.splice(0,0,n)}function V(e){var r=null,n=t.buffer;return n.reverse(),n.some(function(t){if(void 0!==t.valuesToCommit[e])return r=t.valuesToCommit[e],!0}),n.reverse(),r}function w(e){return t.buffer.some(function(t,r,n){if(t.pc===e)return n[r].state=s.calculated,!0}),t.buffer}function B(t){var r=t.valuesToCommit;angular.forEach(r,function(t,r){e.setValueOfReg(r,t)})}function k(e){var t=e.length;return e.some(function(e,r){if(e.branchInfo.state!==s.calculated)return t=r,!0}),t}function A(){return t.buffer[t.buffer.length-1].valuesToCommit}var z={clear:h,modelIsEmpty:p,noMoreUncomitted:v,addTo:g,comfitValues:B,createNewBranchBuffer:m,setBufferToCalculated:w,getNextUncalculated:k,getLatestSpeculatedValues:A,commitCorrectPredictions:M,restorePredictions:y,commitMisprediction:j,setNewPredictionState:x,checkForCalculatedPredictions:b,getValueFromSpeculative:V,blinkMe:I,mispredictedInfo:{}};return z}angular.module("core").factory("speculativeService",e),e.$inject=["registerService","speculativeModel","corelationRegisterService","localHistoryTableService","predictionMachinesService","pcService","common","allPredictorStates","loopCounterService","WBService","speculativeStates","$interval","$window"]}(),function(){"use strict";function e(e,t,r,n,i){function o(){a.corelationRegister.initializeCR()}function c(){var r=e.size,i=t.size;a.corelationRegister.setMaxNumberOfBits(a.corelationRegister.size),n.initialize(),a.locationHistoryTable.initializeLHT(),a.predictionMachines.setMachineSize(r,i)}function u(e){var t={"true":{color:"green"},undefined:{color:"red"}};return t[e.calculated]}var a=this;a.corelationRegister=e,a.locationHistoryTable=t,a.predictionMachines=r,a.speculativeModel=n,a.speculativeStates=i,a.updateValues=c,a.getStyleForPrediction=u,o()}angular.module("app").controller("CorelationRegisterController",e),e.$inject=["corelationRegisterService","localHistoryTableService","predictionMachinesService","speculativeModel","speculativeStates"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CorelationRegisterController",controllerAs:"corReg",templateUrl:"app/corelationRegister/corelation-register.html"};return e}angular.module("app").directive("corelationRegister",e),e.$inject=[]}(),function(){"use strict";function e(e){function t(t){var n=t||a.size;r(n),e.initialize()}function r(e){a.value=[];for(var t=0;t<e;t++)a.value[t]={branchInfo:{predictedValue:0},valuesToCommit:{}};for(var r=0;r<a.pushedOutSize;r++)a.pushedOut[r]={branchInfo:{predictedValue:0},valuesToCommit:{}}}function n(e){var t=a.value.shift();a.value.push(e),a.pushedOut.push(t)}function i(){var t=[];return e.buffer.forEach(function(e){t.push(e.branchInfo.predictedValue)}),t}function o(){var e=i();return e.join("")}function c(){var e=o();return parseInt(e,2)}function u(){a.value=[],t()}var a={value:[],pushedOut:[],size:8,pushedOutSize:6,useCor:!0,lastChangedIndex:null,setMaxNumberOfBits:r,shiftWithValue:n,getRegisterValue:c,initializeCR:t,getRegisterValueArray:i,getRegisterValueString:o,getCopy:i,clear:u};return a}angular.module("app").factory("corelationRegisterService",e),e.$inject=["speculativeModel"]}(),function(){function e(e,t,r,n,i,o){function c(){l.localHistoryTable.initializeLHT()}function u(t){return e.changed.indexOf(t)!==-1}function a(t){var n=r.size,i=e.size;e.setSizeOfRegisters(i),l.predictionMachines.setMachineSize(n,i)}var l=this;l.localHistoryTable=e,l.predictionMachines=i,l.updateValues=a,l.checkIfChanged=u,l.corelationRegister=r,l.speculativeStates=o,c()}angular.module("app").controller("localHistoryTableController",e),e.$inject=["localHistoryTableService","pcService","corelationRegisterService","speculativeModel","predictionMachinesService","speculativeStates"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"localHistoryTableController",controllerAs:"lht",templateUrl:"app/localHistoryTable/local-history-table.html"};return e}angular.module("app").directive("localHistoryTable",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r){function n(){}function i(n){var i=n||v.size,c=r.pow(e.size+t.size,2);v.value=[],v.pushedOut=[],o(c),u(i)}function o(e){for(var t=0;t<e;)v.pushedOut[t]=[],v.value[t++]=[]}function c(e){var t=r.pow(2,e);o(t),v.value=v.value.map(function(t){for(var r=0;r<e;r++)t[r]={predictedValue:0};return t})}function u(e){v.value=v.value.map(function(t){for(var r=0;r<e;r++)t[r]={predictedValue:0};return t})}function a(e,t){v.localHistoryTableActive=!0,v.lastChangedIndex=e,v.changed.indexOf(e)===-1&&v.changed.push(e);var r=v.value[e].shift();v.pushedOut[e].push(r),v.value[e].push(t)}function l(e,t){var r=v.pushedOut[e].pop();v.value[e].pop(),v.value[e].splice(0,0,r)}function s(e){var t=[];return v.value[e].forEach(function(e){t.push(e.predictedValue)}),t}function d(e){var t=f(e),r=parseInt(t,2);return r}function f(e){var t=s(e).join("");return t}function p(){v.value=[],v.changed=[],i()}var v={value:[],pushedOut:[],size:5,changed:[],useLht:!0,localHistoryTableActive:!1,lastChangedIndex:-1,setMaxNumberOfBits:c,setSizeOfRegisters:u,shiftWithValue:a,getLocalHistoryValue:d,getLocalHistoryArray:s,getLocalHistoryString:f,initializeLHT:i,restoreFromOverride:l,clear:p};return n(),v}angular.module("app").factory("localHistoryTableService",e),e.$inject=["corelationRegisterService","speculativeModel","Math"]}(),function(){"use strict";function e(e,t,r,n){function i(){c.predictionMachines.setMachineSize()}function o(t){return e.changed.indexOf(t)!==-1}var c=this;c.numberOfMachines=e.numOfMachines,c.predictionMachines=e,c.checkIfChanged=o,c.speculativeStates=n,i()}angular.module("app").controller("PredictionMachinesController",e),e.$inject=["predictionMachinesService","corelationRegisterService","localHistoryTableService","speculativeStates"]}(),function(){function e(){var e={restrict:"E",controller:"PredictionMachinesController",controllerAs:"pm",templateUrl:"app/predictionMachines/prediction-machines.html"};return e}angular.module("app").directive("predictionMachines",e),e.$inject=[]}(),function(){"use strict";function e(e,t,r,n){function i(t,n){t=t||e.size,n=n||r.size,p.numOfMachines=Math.pow(2,t+n),p.value=[];for(var i=0;i<p.numOfMachines;)p.value[i++]={branchInfo:{},bits:[1,0]}}function o(e,t,r){var n=parseInt(p.value[e].bits.join(""),2),i=Math.pow(2,2)-1;p.lastChangedIndex=e,p.changed.indexOf(e)===-1&&p.changed.push(e),r&&(p.value[e].branchInfo=r),0===t&&n>0?n-=1:1===t&&n<i&&(n+=1);var o=n.toString(2);return p.value[e].bits=u(o,p.sizeOfMachines).split(""),p.value}function c(t){var n,i,o,c,u,a,l,s=e.useCor,d=r.useLht;return s&&!d?(n=e.getCopy(),u=parseInt(n.join(""),2),a=p.value[u].bits.join(""),l=parseInt(a,2),l>=2):!s&&d?(o=t,u=r.getLocalHistoryValue(o),a=p.value[u].bits.join(""),l=parseInt(a,2),l>=2):(i=e.getCopy(),o=t,c=r.getLocalHistoryArray(o),u=parseInt(i.concat(c).join(""),2),a=p.value[u].bits.join(""),l=parseInt(a,2),l>=2)}function u(e,t){for(var r="",n=0;n<t;n++)r+="0";return(r+e).slice(-t)}function a(e,t){p.value[e].bits=t}function l(t,n,i,c){var u=(e.useCor,r.useLht),a=i.predictionMachineIndex;if(p.predictionTableActive=!0,u){var l=i.localHistoryIndex;c&&r.shiftWithValue(l,c)}o(a,t,c)}function s(e){return angular.copy(p.value[e].bits)}function d(e){var t=p.value[e].bits.join("");return parseInt(t,2)}function f(){p.value=[],p.changed=[],i()}var p={numOfMachines:null,sizeOfMachines:2,value:[],changed:[],predictionTableActive:!1,lastChangedIndex:-1,setMachineSize:i,setPrediction:a,getCurrentPrediction:c,updatePredictionsExceptCorelation:l,getCopyOfMachine:s,getValueOfMachine:d,clear:f};return p}angular.module("app").factory("predictionMachinesService",e),e.$inject=["corelationRegisterService","pcService","localHistoryTableService","speculativeModel"]}();