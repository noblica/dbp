<<<<<<< HEAD
!function(){"use strict";angular.module("test",[])}(),function(){"use strict";function e(e,r){function t(e){e.go("app.home")}e.state("app",{"abstract":!0,controller:"AppController",controllerAs:"app",template:"<ui-view></ui-view>"}).state("app.home",{url:"",controller:"TestController",controllerAs:"vm",templateUrl:"app/TestModule/test.html"}),r.when("",t).when("/",t).otherwise("/error/404"),t.$inject=["$state"]}angular.module("app",["ui.router","ui.bootstrap","ngAnimate","core","pipeline","test"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("core",[])}(),function(){"use strict";angular.module("pipeline",[])}(),function(){"use strict";function e(e){function r(){}function t(e){n.localHistoryCollapse=!n.localHistoryCollapse}var n=this;n.corelationRegisterCollapse=!1,n.localHistoryCollapse=!0,n.predictionMachinesCollapse=!0,n.predictionMachinesService=e,n.toggleLocalHistory=t,r()}angular.module("test").controller("TestController",e),e.$inject=["predictionMachinesService"]}(),function(){"use strict";function e(){function e(){console.log("Layout controller loaded!")}e()}angular.module("app").controller("AppController",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(){p.flags={ZF:!1,CF:!1,OF:!1,SF:!1}}function i(n,i){isNaN(n)&&(p.aRegName=n),p.a=t.getValueFromSpeculative(n),null===p.a&&(p.a=r.getValueOfReg(n)),null===p.a&&(p.a=e.getValueOfReg(n)),p.b=void 0!==Number(i)?Number(i):p.b,isNaN(p.b)&&(p.bRegName=i,p.b=t.getValueFromSpeculative(i),null===p.b&&(p.b=r.getValueOfReg(i)),null===p.b&&(p.b=e.getValueOfReg(i)))}function o(e,r,t){function n(){return y=p.b}function o(){return y=p.a+p.b,s(!1),d(!1),Math.abs(y)>p.maxValue&&(s(!0),y=a(y)),j=u(y),c(M,F,j)&&d(!0),y}function v(){return s(!1),d(!1),l(!1),y=a(p.a-p.b),p.b>p.a&&s(!0),p.b===p.a&&l(!0),j=u(y),c(M,F,j)&&d(!0),y}function h(){return s(!1),d(!1),l(!1),y=p.a*p.b,0===y&&l(!0),Math.abs(y)>p.maxValue&&(s(!0),y=a(y)),j=u(y),c(M,F,j)&&d(!0),y}function m(){return d(!1),y=p.a/p.b,j===1/0&&d(!0),y}function g(){return y=p.a&p.b,f(!!u(y)),y}function I(){return y=p.a|p.b,f(!!u(y)),y}function b(){return y=p.a^p.b,f(!!u(y)),y}function P(){return l(!1),f(!1),y=p.a&p.b,0===y&&l(!0),f(!!u(y)),y}function S(){return y=~p.a}function C(){console.log("end reached!")}i(e,r);var y=p.cmpResult,M=u(p.a),F=u(p.b),j=null,x={mov:n,add:o,sub:v,cmp:v,mul:h,div:m,and:g,or:I,xor:b,test:P,not:S,end:C};return p.cmpResult=x[t](),p.cmpResult}function c(e,r,t){return e===r&&t!==e}function u(e){var r=p.bitSize,t=a(e),n=t.toString(2),i=Number(n.split("").reverse()[r]);return i?i:0}function a(e){return Number(e)&p.maxValue}function l(e){return p.flags.ZF=void 0===e?0===p.cmpResult:e,p.flags}function s(e){return p.flags.CF=void 0===e?p.flags.CF:e,p.flags}function d(e){return p.flags.OF=e,void 0===e&&(p.flags.OF=void 0===e?p.flags.OF:e),p.flags}function f(e){return p.flags.SF=e||p.cmpResult<0||p.cmpResult>p.maxValue,p.flags}var p={flags:{ZF:!1,CF:!1,OF:!1,SF:!1},a:0,aRegName:"",b:0,bRegName:"",cmpResult:0,maxValue:Math.pow(2,16)-1,maxValueSigned:Math.pow(2,15)-1,bitSize:15,compareAndSetFlags:o,resetFlags:n};return p}angular.module("app").factory("aluService",e),e.$inject=["registerService","WBService","speculativeService"]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a,l,s,d,f,p,v,h,m,g){function I(e){var r=e.split("\n"),t=y(r);f.buffer=[],x.codeArray=a.setAndRemoveLabelsFromCodeArray(t),s.pipelineStarted=!0,s.predictionEventFlag=!1,l.pc=-1,s.forceStop=!1,c.endReached=!1,v.resetFlags(),s.currentPredictionState=h.predicting,l.setNewPc(),F(l.pc,x.codeArray)}function b(e){var r={1:function(e){1!==x.previousState&&(x.previousState=1,g.alert("Going to the next flag generating/jump instructions")),P(e)},2:function(){2!==x.previousState&&(x.previousState=2,g.alert("Undoing mispredictions, one by one")),d.restorePredictions()},3:function(){3!==x.previousState&&(x.previousState=3,g.alert("Commiting the misprediction")),d.commitMisprediction(),d.checkForCalculatedPredictions()?s.currentPredictionState=h.commitCorrectPrediction:s.currentPredictionState=h.predicting},4:function(){4!==x.previousState&&(x.previousState=4,g.alert("Commiting the correctly made predictions")),d.commitCorrectPredictions()}};r[s.currentPredictionState](e)}function P(e){do M(l.pc,e);while(!C(e)&&!S()&&!s.predictionEventFlag);s.predictionEventFlag=!1,d.setNewPredictionState(),C(e)&&(s.removePredictedClassOnEnd(),s.resetLastChangedIndexes(),s.flushPipeline(),m.clear(),d.clear(),s.flushPipeline(!1,!1,!1,!0),s.pipelineStarted=!1,s.pipelineActive=!1,g.alert("Finished!"))}function S(){return o.instructionsInEX.some(function(e){return p.isJmpInstruction(e.operation)||p.isFlagGenInstruction(e.operation)})}function C(e){var r=s.isPipelineEmpty(),t=d.modelIsEmpty(),n=!l.overridePc,i=s.forceStop;return r&&t&&n||i}function y(e){var r=e.filter(function(e){return""!==e});return r}function M(e,r,t){j(),l.setNewPc(),F(l.pc,r,t)}function F(r,n,o){e.parse(r,n,1),t.parse(),i.parse(),c.parse()}function j(){c.pipeThrough(),i.pipeThrough(),t.pipeThrough(),e.pipeThrough()}var x=this;x.codeInput="mov ax, 0\nmov bx, 3\nmov cx, 5\nloop-l1:\nadd ax, 1\nmov dx, 0\nloop-l2:\nadd dx, ax\ncmp dx, cx\njl loop-l2\nadd cx, ax\ncmp ax, bx\njl loop-l1\nend",x.codeArray=[],x.pipelineStarted=!1,x.endReached=!1,x.trapFlag=!1,x.loopCounter=m.counter,x.IFModel=r,x.IDModel=n,x.EXModel=o,x.WBModel=u,x.common=s,x.previousState=-1,x.doPrediction=I,x.goToNextBranchInstruction=b}angular.module("app").controller("CodeInputController",e),e.$inject=["IFService","IFModel","IDService","IDModel","EXService","EXModel","WBService","WBModel","labelService","pcService","common","speculativeService","speculativeModel","jmpInstructionService","aluService","allPredictorStates","loopCounterService","$window"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CodeInputController",controllerAs:"ci",templateUrl:"app/codeInput/code-input.html"};return e}angular.module("app").directive("codeInput",e),e.$inject=[]}(),function(){"use strict";function e(e){function r(e){var r={name:e,count:1};a.counter.push(r)}function t(e){var r=null;return a.counter.some(function(t,n){if(t.name===e)return r=n,!0}),r}function n(e,r){var t={1:function(e){return e+1},0:function(e){return 0}},n=a.counter[e].count;a.counter[e].count=t[r](n),0===a.counter[e].count&&a.counter.splice(e,1)}function i(e,r){var t=a.checkIfLoop(e),n=null;null!==t&&(n=a.getLoopIndex(t),null!==n?a.updateLoopCount(n,r):1===r&&a.createCounter(t))}function o(r){var t=e.getLabelName(r),n=null;return null!==t&&(n=c(t)),n}function c(e){var r="loop-",t="";return e.substring(0,5)===r&&(t=e.substring(5)),t}function u(){a.counter.splice(0,a.counter.length)}var a={counter:[],createCounter:r,getLoopIndex:t,updateLoopCount:n,checkAndHandleLoopLabelPc:i,checkIfLoop:o,clear:u};return a}angular.module("app").factory("loopCounterService",e),e.$inject=["labelService"]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u){function a(i,o,c,u){void 0===i?(e.flush(),r.flush(),t.flush()):(i&&e.flush(),o&&r.flush(),c&&t.flush(),u&&n.flush())}function l(){return 0===e.instructionsInIF.length&&0===r.instructionsInID.length&&0===t.instructionsInEX.length&&0===n.instructionsInWB.length}function s(e){var r=null!==e.firstOperator,t=null!==e.secondOperator;return e.operation+" "+(r?e.firstOperator:"")+(t?", "+e.secondOperator:"")}function d(){i.lastChangedIndex=null,o.lastChangedIndex=null,c.lastChangedIndex=null,u.lastChangedIndex=null}function f(){p(c.value),p(u.value)}function p(e){return e.map(function(e){return e.predicted=!1,e}),e}var v={pipelineStarted:!1,pipelineActive:!1,removingMispredctions:!1,currentPredictionState:null,flushPipeline:a,isPipelineEmpty:l,instructionToText:s,predictionEventFlag:!1,removePredictedClassOnEnd:f,resetLastChangedIndexes:d};return v}angular.module("core").factory("common",e),e.$inject=["IFModel","IDModel","EXModel","WBModel","corelationRegisterService","speculativeModel","localHistoryTableService","predictionMachinesService"]}(),function(){"use strict";var e={predicting:1,undoMisprediction:2,commitMisprediction:3,commitCorrectPrediction:4};angular.module("core").constant("allPredictorStates",e)}(),function(){"use strict";function e(e){function r(){o.jmpInstructions=["jmp","je","jz","jne","jnz","jg","jnle","jge","jnl","jl","jnge","jle","jng"],o.flagGenInstructions=["test","cmp"]}function t(e){return o.jmpInstructions.indexOf(e)!==-1}function n(e){return o.flagGenInstructions.indexOf(e)!==-1}function i(r){var t=e.flags,n={jmp:!0,je:t.ZF,jz:t.ZF,jne:!t.ZF,jnz:!t.ZF,jg:!t.ZF&&t.SF===t.OF,jnle:!t.ZF&&t.SF===t.OF,jge:t.SF===t.OF,jnl:t.SF===t.OF,jl:t.SF!==t.OF,jnge:t.SF!==t.OF,jle:t.ZF||t.SF!==t.OF,jng:t.ZF||t.SF!==t.OF};return n[r]}var o={jmpInstructions:[],isJmpInstruction:t,isFlagGenInstruction:n,checkBranchCondition:i};return r(),o}angular.module("core").factory("jmpInstructionService",e),e.$inject=["aluService"]}(),function(){"use strict";function e(){function e(e,r){var t={};t[e.toLowerCase()]=r,i.labelArray.push(t)}function r(e){var r=null;return i.labelArray.some(function(t){if(void 0!==t[e])return r=t,!0}),r[e]}function t(e){var r=null;return i.labelArray.some(function(t){for(var n in t)t.hasOwnProperty(n)&&t[n]===e&&(r=n)}),r}function n(r){for(var t=r,n=0;n<r.length;){var i=r[n];if(i.indexOf(":")!==-1){var o=i.slice(0,i.indexOf(":"));t.splice(n,1),e(o,n)}else n++}return t}var i={labelArray:[],getAddress:r,getLabelName:t,setLabelAddress:e,setAndRemoveLabelsFromCodeArray:n};return i}angular.module("core").factory("labelService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){r.pc+=1,null!==r.overridePc&&(r.pc=r.overridePc,r.overridePc=null)}var r={pc:-1,branchesPredictedTaken:[],overridePc:null,setNewPc:e};return r}angular.module("core").factory("pcService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInEX=[],r.writeBackResults=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInEX,writeBackResults:r.writeBackResults};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,nextPredictionFalse:!1,instructionsInEX:[],writeBackResults:[],flush:e};return r}angular.module("core").factory("EXModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a,l,s,d,f,p,v,h){function m(r){return o.writeBackResults=[],C(o.instructionsInEX),P(),o.returnPromise=e.defer(),o.returnPromise.promise}function g(e,r){var c=t.checkBranchCondition(e.operation),u=n.getAddress(e.firstOperator),a=o.currentPc+r,v=(i.branchesPredictedTaken.indexOf(a),S()),h=d.getCurrentPrediction(a),m={pc:a,jmpToPc:u,delay:v,predictedValue:h?1:0,calculatedValue:c?1:0},g=f.getCopy(),I=l.formPredictedArray(l.buffer),b=(parseInt(g.concat(I).join(""),2),a),P=(f.useCor,p.useLht,p.getCopyOfLocalHistoryArrayFor(b)),C=g.concat(I),y=parseInt(C.concat(P).join(""),2),M=d.getCopyOfMachine(y),F={localHistoryIndex:b,localHistoryArray:P,predictionMachineIndex:y,predictionMachineValue:M};d.updatePredictionsExceptCorelation(m.predictedValue,m.pc),s.createNewBranchBuffer(m,F),l.addingToSpeculative=!0}function I(e){var r=e.branchInfo.predictedValue,t=e.branchInfo.calculatedValue,n=e.branchInfo.pc,c=i.branchesPredictedTaken.indexOf(n);if(o.nextPredictionFalse&&(t=!t),t&&!r)return a.flushPipeline(),e.branchInfo.mispredicted=!0,e.branchInfo.mispredictionPc=e.branchInfo.jmpToPc,e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0;if(t&&r)i.branchesPredictedTaken.splice(c,1),e.branchInfo.shouldCommit=!0;else if(t||r){if(!t&&r)return a.flushPipeline(),e.branchInfo.mispredicted=!0,e.branchInfo.mispredictionPc=n+1,i.branchesPredictedTaken.splice(c,1),e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0}else e.branchInfo.shouldCommit=!0;return!1}function b(e){o.writeBackResults=M(e)}function P(){l.buffer.map(function(e,r){return e.branchInfo.delay&&(e.branchInfo.delay-=1,0===e.branchInfo.delay&&(l.lastChangedIndex=r,e.branchInfo.calculated=!0,I(e),a.predictionEventFlag=!0)),e}),0===l.buffer.length&&(l.addingToSpeculative=!1)}function S(){return h.floor(20*h.random()+4)}function C(e){return e.some(function(e,r){var n=e.operation,i=t.isJmpInstruction(n),o=t.isFlagGenInstruction(n);if((i||o)&&(a.predictionEventFlag=!0),i){var c=g(e,r);return c}b(e)}),o.instructionsInEX}function y(){if(o.returnPromise){var r={currentPc:o.currentPc,instructionSet:o.instructionsInEX,writeBackResults:o.writeBackResults};return o.returnPromise.resolve(r),c.currentPc=r.currentPc,c.instructionsInWB=r.instructionSet,c.writeBackResults=r.writeBackResults,o.returnPromise.promise}return e.resolve()}function M(e){var t=e.firstOperator,n=e.secondOperator,i=e.operation,c=r.compareAndSetFlags(t,n,i),a={currentPc:o.currentPc,register:e.firstOperator,result:c,operation:i};return l.addingToSpeculative?u.shouldWriteBack(i)&&s.addTo(t,c):o.writeBackResults.push(a),o.writeBackResults}var F={parse:m,pipeThrough:y,parseJumpInstruction:g};return F}angular.module("core").factory("EXService",e),e.$inject=["$q","aluService","jmpInstructionService","labelService","pcService","EXModel","WBModel","WBService","common","speculativeModel","speculativeService","predictionMachinesService","corelationRegisterService","localHistoryTableService","loopCounterService","Math"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInID=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInID};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,instructionsInID:[],flush:e};return r}angular.module("core").factory("IDModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(t){return r.instructionsInID=c(r.instructionsInID),r.returnPromise=e.defer(),r.returnPromise.promise}function i(){if(r.returnPromise){var n={currentPc:r.currentPc,instructionSet:r.instructionsInID};return r.returnPromise.resolve(n),t.currentPc=n.currentPc,t.instructionsInEX=n.instructionSet,r.returnPromise.promise}return e.resolve()}function o(e){var r=e.replace(",",""),t=r.split(" "),n={operation:t[0].toLowerCase(),firstOperator:void 0===t[1]?null:t[1].toLowerCase(),secondOperator:void 0===t[2]?null:t[2].toLowerCase()};return n}function c(e){var r=[];return e.forEach(function(e){var t=o(e);r.push(t)}),r}var u={parse:n,pipeThrough:i,decodeSingleInstruction:o};return u}angular.module("core").factory("IDService",e),e.$inject=["$q","IDModel","EXModel"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInIF=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInIF};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,instructionsInIF:[],flush:e};return r}angular.module("core").factory("IFModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a){function l(t,n,i){r.currentPc=t||0,i=i||1,r.returnPromise=e.defer();var o=r.currentPc,c=r.currentPc+i;v.codeArrayInput=angular.copy(n);var u=n.slice(o,c);return s(u),r.instructionsInIF=u,a.checkAndHandleLoopLabelPc(t,1),r.returnPromise.promise}function s(e){for(var t=0;t<e.length;){var o=e[t],a=n.decodeSingleInstruction(o),l=t+r.currentPc,s=i.isJmpInstruction(a.operation),p=u.getCurrentPrediction(l)?1:0;if(s&&p){var v=e.length-t-1,h=f(a);if(v>0){var m=d(h,v);e.splice(t,v),e.concat(m)}c.branchesPredictedTaken.push(l),c.overridePc=h+v}t++}return e}function d(e,r){var t=e+r;return v.codeArrayInput.slice(e,t)}function f(e){var r=e.firstOperator;return o.getAddress(r)}function p(){if(r.returnPromise){var n={currentPc:r.currentPc,instructionSet:r.instructionsInIF};return r.returnPromise.resolve(n),t.currentPc=n.currentPc,t.instructionsInID=n.instructionSet,r.returnPromise.promise}return e.resolve()}var v={currentPc:null,returnPromise:null,instructionsInIF:[],codeArrayInput:[],parse:l,pipeThrough:p};return v}angular.module("core").factory("IFService",e),e.$inject=["$q","IFModel","IDModel","IDService","jmpInstructionService","labelService","pcService","predictionMachinesService","loopCounterService"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInWB=[],r.writeBackResults=[],r.returnPromise.resolve()}var r={currentPc:null,returnPromise:null,instructionsInWB:[],writeBackResults:[],flush:e};return r}angular.module("core").factory("WBModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(e){return i(t.writeBackResults),t.returnPromise=r.defer(),t.returnPromise.promise}function i(r){r.forEach(function(r){var t=r.register,n=r.result,i=r.operation;"end"===i&&(s.endReached=!0),c(i)&&e.setValueOfReg(t,n)})}function o(e){t.writeBackResults=t.writeBackResults.filter(function(r){return r.register!==e})}function c(e){return l.indexOf(e)===-1}function u(){return t.returnPromise?(t.returnPromise.resolve(t.writeBackResults),t.returnPromise.promise):r.resolve()}function a(e){var r=null;return t.writeBackResults.some(function(t){if(e===t.register)return r=t.result,!0}),r}var l=["cmp","end"],s={endReached:!1,parse:n,pipeThrough:u,shouldWriteBack:c,getValueOfReg:a,removeFromWriteback:o};return s}angular.module("core").factory("WBService",e),e.$inject=["registerService","$q","WBModel"]}(),function(){"use strict";angular.module("core").constant("Math",window.Math)}(),function(){"use strict";function e(e){function r(e){var r=0;return void 0!==n.coreRegisters[e]?r=n.coreRegisters[e]:void 0!==n.otherRegisters[e]?r=n.otherRegisters[e]:n.otherRegisters[e]=0,r}function t(e,r){return void 0!==n.coreRegisters[e]?n.coreRegisters[e]=r:n.otherRegisters[e]=r,e}var n={coreRegisters:{ax:0,bx:0,cx:0,dx:0,sp:0,bp:0,si:0,di:0},otherRegisters:{},getValueOfReg:r,setValueOfReg:t};return n}angular.module("core").factory("registerService",e),e.$inject=["speculativeModel"]}(),function(){"use strict";function e(){function e(e){var t=e||i.size;r(t)}function r(e){i.buffer=[];for(var r=0;r<e;r++)i.buffer[r]={branchInfo:{predictedValue:0},valuesToCommit:{},predictionOverrides:{}}}function t(e){i.buffer.shift(),i.buffer.push(e)}function n(e){var r=[];return e.forEach(function(e){r.push(e.branchInfo.predictedValue)}),r}var i={addingToSpeculative:!1,buffer:[],size:6,lastChangeIndex:null,initialize:e,setMaxNumberOfBits:r,shiftWithValue:t,formPredictedArray:n,limitWasReached:!1};return i}angular.module("core").factory("speculativeModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a,l,s,d){function f(){return 0===r.buffer.length}function p(){r.buffer=[]}function v(e,t){var n={branchInfo:e,valuesToCommit:{},predictionOverrides:t};return I(n),r.buffer[r.buffer.length-1]}function h(e,t){var n=r.buffer.length-1;r.buffer[n].valuesToCommit[e]=t}function m(){var e=r.buffer;return e[0]&&e[0].branchInfo.calculated}function g(){var e=r.buffer,o=e[0];if(o&&o.branchInfo.calculated){var a=o.branchInfo.calculatedValue,l=o.predictionOverrides,s=l.localHistoryIndex;n.predictionComitted(s);var f=l.predictionMachineIndex;i.predictionComitted(f),t.useCor&&t.value.push(a),o.branchInfo.shouldCommit&&x(o),r.lastChangedIndex=null,t.lastChangedIndex=t.value.length-1,e.splice(0,1),r.limitWasReached&&(d.alert("Predictions no longer at the limit. New predictions can now be pushed."),r.limitWasReached=!1,c.predictionEventFlag=!0)}else d.alert("No more predictions to commit!"),c.currentPredictionState=u.predicting,t.lastChangedIndex=null}function I(e){var n=(t.value.length,t.size,r.buffer.length),i=r.size;if(n<i){if(t.lastChangedIndex=null,r.lastChangedIndex=r.buffer.length,r.buffer.push(e),t.useCor){var o=t.value.shift();t.pushedOut.push(o)}}else d.alert("Unable to push prediction, because prediction limit has been reached."),r.limitWasReached=!0,c.predictionEventFlag=!0}function b(){var e=r.buffer,t=T.mispredictedInfo.mispredictedIndex,n=e[t],i=null;i=e[e.length-1],i&&i!==n?(P(i),M(),e.pop(),r.lastChangedIndex=e.length-1):(P(n),c.currentPredictionState=u.commitMisprediction,r.lastChangedIndex=null,d.alert("Finished misprediction recovery."))}function P(e){var r=e.predictionOverrides.localHistoryIndex,t=e.predictionOverrides.localHistoryArray,o=e.predictionOverrides.predictionMachineIndex,c=e.predictionOverrides.predictionMachineValue,u=e.branchInfo.jmpToPc;n.setLocalHistoryArray(r,t),n.lastChangedIndex=r,i.setPrediction(o,c),i.lastChangedIndex=o,a.checkAndHandleLoopLabelPc(u,e.branchInfo.calculatedValue)}function S(){r.buffer;c.currentPredictionState=u.predicting,T.mispredictedInfo=C(),null!==T.mispredictedInfo.mispredictedIndex?c.currentPredictionState=u.undoMisprediction:m()&&(c.currentPredictionState=u.commitCorrectPrediction)}function C(){var e=r.buffer,t={mispredictedIndex:null,updateWith:null,pcToUse:0,predictionOverrides:{}};return e.some(function(e,r,n){if(e.branchInfo.mispredicted)return c.removingMispredictions=!0,e.branchInfo.mispredicted=null,t={updateWith:e.branchInfo.calculatedValue,mispredictedIndex:r,pcToUse:e.branchInfo.pc,predictionOverrides:e.predictionOverrides},o.overridePc=e.branchInfo.mispredictionPc,!0}),t}function y(){var e=r.buffer,t=T.mispredictedInfo,n=t.mispredictedIndex,o=t.updateWith,c=t.pcToUse,u=t.predictionOverrides;return r.lastChangedIndex=n,null!==n&&i.updatePredictionsExceptCorelation(o,c,u),e}function M(){var e=t.pushedOut.pop();t.value.splice(0,0,e)}function F(e){var t=null,n=r.buffer;return n.reverse(),n.some(function(r){if(void 0!==r.valuesToCommit[e])return t=r.valuesToCommit[e],!0}),n.reverse(),t}function j(e){return r.buffer.some(function(r,t,n){if(r.pc===e)return n[t].calculated=!0,!0}),r.buffer}function x(r){var t=r.valuesToCommit;angular.forEach(t,function(r,t){e.setValueOfReg(t,r)})}function R(e){var r=e.length;return e.some(function(e,t){if(!e.branchInfo.calculated)return r=t,!0}),r}function O(){return r.buffer[r.buffer.length-1].valuesToCommit}var T={clear:p,modelIsEmpty:f,addTo:h,comfitValues:x,createNewBranchBuffer:v,setBufferToCalculated:j,getNextUncalculated:R,getLatestSpeculatedValues:O,commitCorrectPredictions:g,restorePredictions:b,commitMisprediction:y,setNewPredictionState:S,checkForCalculatedPredictions:m,getValueFromSpeculative:F,mispredictedInfo:{}};return T}angular.module("core").factory("speculativeService",e),e.$inject=["registerService","speculativeModel","corelationRegisterService","localHistoryTableService","predictionMachinesService","pcService","common","allPredictorStates","loopCounterService","WBService","$interval","$window"]}(),function(){"use strict";function e(e,r,t,n){function i(){u.corelationRegister.initializeCR()}function o(){var t=e.size,n=r.size;u.corelationRegister.setMaxNumberOfBits(u.corelationRegister.size),u.locationHistoryTable.initializeLHT(),u.predictionMachines.setMachineSize(t,n)}function c(e){var r={"true":{color:"green"},undefined:{color:"red"}};return r[e.calculated]}var u=this;u.corelationRegister=e,u.locationHistoryTable=r,u.predictionMachines=t,u.speculativeModel=n,u.updateValues=o,u.getStyleForPrediction=c,i()}angular.module("app").controller("CorelationRegisterController",e),e.$inject=["corelationRegisterService","localHistoryTableService","predictionMachinesService","speculativeModel"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CorelationRegisterController",controllerAs:"corReg",templateUrl:"app/corelationRegister/corelation-register.html"};return e}angular.module("app").directive("corelationRegister",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){var t=e||c.size;r(t)}function r(e){c.value=[];for(var r=0;r<e;r++)c.value[r]=0}function t(e){var r=c.value.shift();c.value.push(e),c.pushedOut.push(r)}function n(){var e=c.value.join("");return parseInt(e,2)}function i(){return angular.copy(c.value)}function o(){c.value=[],e()}var c={value:[],pushedOut:[],size:12,useCor:!0,lastChangedIndex:null,setMaxNumberOfBits:r,shiftWithValue:t,getRegisterValue:n,initializeCR:e,getCopy:i,clear:o};return c}angular.module("app").factory("corelationRegisterService",e),e.$inject=[]}(),function(){function e(e,r,t,n,i){function o(){a.localHistoryTable.initializeLHT()}function c(r){return e.changed.indexOf(r)!==-1}function u(r){var n=t.size,i=e.size;e.setSizeOfRegisters(),a.predictionMachines.setMachineSize(n,i)}var a=this;a.localHistoryTable=e,a.predictionMachines=i,a.updateValues=u,a.checkIfChanged=c,a.corelationRegister=t,o()}angular.module("app").controller("localHistoryTableController",e),e.$inject=["localHistoryTableService","pcService","corelationRegisterService","speculativeModel","predictionMachinesService"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"localHistoryTableController",controllerAs:"lht",templateUrl:"app/localHistoryTable/local-history-table.html"};return e}angular.module("app").directive("localHistoryTable",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(){}function i(n){var i=n||v.size,c=t.pow(e.size+r.size,2);v.value=[],o(c),u(i)}function o(e){for(var r=0;r<e;)v.value[r++]={predicted:!1,bits:[]}}function c(e){var r=t.pow(2,e);o(r),v.value=v.value.map(function(r){for(var t=0;t<e;t++)r.bits[t]=0;return r})}function u(e){v.value=v.value.map(function(r){r.bits=[];for(var t=0;t<e;t++)r.bits[t]=0;return r})}function a(e,r){v.localHistoryTableActive=!0,v.lastChangedIndex=e,v.changed.indexOf(e)===-1&&v.changed.push(e),v.value[e].predicted=!0,v.value[e].bits.shift(),v.value[e].bits.push(r)}function l(e){return angular.copy(v.value[e].bits)}function s(e,r){return angular.copy(r,v.value[e].bits)}function d(e){var r=v.value[e].bits.join(""),t=parseInt(r,2);return t}function f(e){v.value[e].predicted=!1}function p(){v.value=[],v.changed=[],i()}var v={value:[],size:3,changed:[],useLht:!0,localHistoryTableActive:!1,lastChangedIndex:-1,setMaxNumberOfBits:c,setSizeOfRegisters:u,shiftWithValue:a,getLocalHistoryValue:d,initializeLHT:i,getCopyOfLocalHistoryArrayFor:l,setLocalHistoryArray:s,predictionComitted:f,clear:p};return n(),v}angular.module("app").factory("localHistoryTableService",e),e.$inject=["corelationRegisterService","speculativeModel","Math"]}(),function(){"use strict";function e(e,r,t){function n(){o.predictionMachines.setMachineSize()}function i(r){return e.changed.indexOf(r)!==-1}var o=this;o.numberOfMachines=e.numOfMachines,o.predictionMachines=e,o.checkIfChanged=i,n()}angular.module("app").controller("PredictionMachinesController",e),e.$inject=["predictionMachinesService","corelationRegisterService","localHistoryTableService"]}(),function(){function e(){var e={restrict:"E",controller:"PredictionMachinesController",controllerAs:"pm",templateUrl:"app/predictionMachines/prediction-machines.html"};return e}angular.module("app").directive("predictionMachines",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n){function i(r,n){r=r||e.size,n=n||t.size,h.numOfMachines=Math.pow(2,r+n),h.value=[];for(var i=0;i<h.numOfMachines;)h.value[i++]={predicted:!1,bits:[1,0]}}function o(e,r){var t=parseInt(h.value[e].bits.join(""),2),n=Math.pow(2,2)-1;h.lastChangedIndex=e,h.changed.indexOf(e)===-1&&h.changed.push(e),0===r&&t>0?t-=1:1===r&&t<n&&(t+=1);var i=t.toString(2);return h.value[e].predicted=!0,h.value[e].bits=u(i,h.sizeOfMachines).split(""),h.value}function c(r){var i,o,c,u,a,l,s,d,f=e.useCor,p=t.useLht;return f&&!p?(i=e.getCopy(),c=n.formPredictedArray(n.buffer),l=parseInt(i.concat(c).join(""),2),s=h.value[l].bits.join(""),d=parseInt(s,2),d>=2):!f&&p?(u=r,l=t.getLocalHistoryValue(u),s=h.value[l].bits.join(""),d=parseInt(s,2),d>=2):(i=e.getCopy(),c=n.formPredictedArray(n.buffer),u=r,a=t.getCopyOfLocalHistoryArrayFor(u),o=i.concat(c),l=parseInt(o.concat(a).join(""),2),s=h.value[l].bits.join(""),d=parseInt(s,2),d>=2)}function u(e,r){for(var t="",n=0;n<r;n++)t+="0";return(t+e).slice(-r)}function a(e,r){h.value[e].bits=r}function l(i){var c=e.useCor,u=t.useLht,a=e.getCopy(),l=n.formPredictedArray(n.buffer),s=r.pc,d=t.getCopyOfLocalHistoryArrayFor(s),f=a.concat(l),p=parseInt(f.concat(d).join(""),2);h.predictionTableActive=!0,c&&!u?p=parseInt(a.concat(l).join(""),2):!c&&u&&(s=r.pc,p=t.getLocalHistoryValue(s)),o(p,i),u&&t.shiftWithValue(s,i),c&&e.shiftWithValue(i)}function s(r,i,c){var u=e.useCor,a=t.useLht,l=e.getCopy(),s=n.formPredictedArray(n.buffer),d=parseInt(l.concat(s).join(""),2),f=l.concat(s),p=i,v=t.getCopyOfLocalHistoryArrayFor(p),m=parseInt(f.concat(v).join(""),2);h.predictionTableActive=!0,c&&(p=c.localHistoryIndex,m=c.predictionMachineIndex),u&&!a?m=d:!u&&a&&(m=t.getLocalHistoryValue(p)),a&&t.shiftWithValue(p,r),o(m,r)}function d(e){return angular.copy(h.value[e].bits)}function f(e){var r=h.value[e].bits.join("");return parseInt(r,2)}function p(e){h.value[e].predicted=!1}function v(){h.value=[],h.changed=[],i()}var h={numOfMachines:null,sizeOfMachines:2,value:[],changed:[],predictionTableActive:!1,lastChangedIndex:-1,setMachineSize:i,setPrediction:a,getCurrentPrediction:c,updatePredictions:l,updatePredictionsExceptCorelation:s,getCopyOfMachine:d,getValueOfMachine:f,clear:v,predictionComitted:p};return h}angular.module("app").factory("predictionMachinesService",e),e.$inject=["corelationRegisterService","pcService","localHistoryTableService","speculativeModel"]}();
=======
!function(){"use strict";angular.module("test",[])}(),function(){"use strict";function e(e,r){function n(e){e.go("app.home")}e.state("app",{"abstract":!0,controller:"AppController",controllerAs:"app",template:"<ui-view></ui-view>"}).state("app.home",{url:"",controller:"TestController",controllerAs:"vm",templateUrl:"app/TestModule/test.html"}),r.when("",n).when("/",n).otherwise("/error/404"),n.$inject=["$state"]}angular.module("app",["ui.router","ui.bootstrap","ngAnimate","core","pipeline","test"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("core",[])}(),function(){"use strict";angular.module("pipeline",[])}(),function(){"use strict";function e(e){function r(){}function n(e){t.localHistoryCollapse=!t.localHistoryCollapse,console.log(t.localHistoryCollapse)}var t=this;t.corelationRegisterCollapse=!1,t.localHistoryCollapse=!0,t.predictionMachinesCollapse=!0,t.predictionMachinesService=e,t.toggleLocalHistory=n,r()}angular.module("test").controller("TestController",e),e.$inject=["predictionMachinesService"]}(),function(){"use strict";function e(){function e(){console.log("Layout controller loaded!")}e()}angular.module("app").controller("AppController",e),e.$inject=[]}(),function(){"use strict";function e(e){function r(r,n){s.a=e.getValueOfReg(r),s.b=void 0!==Number(n)?Number(n):s.b,isNaN(n)&&(s.bRegName=n,s.b=e.getValueOfReg(n))}function n(n,f,p){function d(){return e.setValueOfReg(s.aRegName,s.b),M=s.b}function v(){return M=s.a+s.b,u(!1),a(!1),Math.abs(M)>s.maxValue&&(u(!0),M=o(M)),C=i(M),t(O,j,C)&&a(!0),e.setValueOfReg(s.aRegName,M),M}function h(){return u(!1),a(!1),c(!1),M=o(s.a-s.b),s.b>s.a&&u(!0),s.b===s.a&&c(!0),C=i(M),t(O,j,C)&&a(!0),e.setValueOfReg(s.aRegName,M),M}function m(){return u(!1),a(!1),c(!1),M=s.a*s.b,0===M&&c(!0),Math.abs(M)>s.maxValue&&(u(!0),M=o(M)),C=i(M),t(O,j,C)&&a(!0),M}function g(){return a(!1),M=s.a/s.b,C===1/0&&a(!0),M}function I(){return M=s.a&s.b,l(!!i(M)),e.setValueOfReg(s.aRegName,M),M}function b(){return M=s.a|s.b,l(!!i(M)),e.setValueOfReg(s.aRegName,M),M}function P(){return M=s.a^s.b,l(!!i(M)),e.setValueOfReg(s.aRegName,M),M}function y(){return c(!1),l(!1),M=s.a&s.b,0===M&&c(!0),l(!!i(M)),M}function S(){return M=~s.a,e.setValueOfReg(s.aRegName,M),M}function R(){console.log("end reached!")}r(n,f);var M=s.cmpResult,O=i(s.a),j=i(s.b),C=null,F={mov:d,add:v,sub:h,cmp:h,mul:m,div:g,and:I,or:b,xor:P,test:y,not:S,end:R};return s.cmpResult=F[p](),s.cmpResult}function t(e,r,n){return e===r&&n!==e}function i(e){var r=s.bitSize,n=o(e),t=n.toString(2),i=Number(t.split("").reverse()[r]);return i?i:0}function o(e){return Number(e)&s.maxValue}function c(e){return s.flags.ZF=void 0===e?0===s.cmpResult:e,s.flags}function u(e){return s.flags.CF=void 0===e?s.flags.CF:e,s.flags}function a(e){return s.flags.OF=e,void 0===e&&(s.flags.OF=void 0===e?s.flags.OF:e),s.flags}function l(e){return s.flags.SF=e||s.cmpResult<0||s.cmpResult>s.maxValue,s.flags}var s={flags:{ZF:!1,CF:!1,OF:!1,SF:!1},a:0,aRegName:"",b:0,bRegName:"",cmpResult:0,maxValue:Math.pow(2,16)-1,maxValueSigned:Math.pow(2,15)-1,bitSize:15,compareAndSetFlags:n};return s}angular.module("app").factory("aluService",e),e.$inject=["registerService"]}(),function(){"use strict";function e(e,r,n,t,i,o,c,u,a,l,s,f,p,d,v){function h(e){var r=e.split("\n"),n=P(r);d.buffer=[],M.codeArray=a.setAndRemoveLabelsFromCodeArray(n),s.pipelineStarted=!0,l.pc=-1,M.stepByStep?(l.setNewPc(),S(l.pc,M.codeArray)):I(M.codeArray)}function m(e){s.pipelineInterval=f(function(){g()&&M.trapFlag?(f.cancel(s.pipelineInterval),M.trapFlag=!1):(M.trapFlag=!0,y(l.pc,e).then(function(){b(e)&&(f.cancel(s.pipelineInterval),s.flushPipeline(),p.clear(),s.flushPipeline(!1,!1,!1,!0),s.pipelineStarted=!1,s.pipelineActive=!1)}))},10)}function g(){return o.instructionsInEX.some(function(e){return v.isJmpInstruction(e.operation)||v.isFlagGenInstruction(e.operation)})}function I(e){s.pipelineInterval=f(function(){y(l.pc,e).then(function(){b(e)&&(f.cancel(s.pipelineInterval),s.flushPipeline(),p.clear(),s.flushPipeline(!1,!1,!1,!0),s.pipelineStarted=!1,s.pipelineActive=!1)},10)})}function b(e){var r=s.isPipelineEmpty(),n=p.modelIsEmpty(),t=c.endReached;return r&&n&&t}function P(e){var r=e.filter(function(e){return""!==e});return r}function y(e,r,n){return R().then(function(){l.setNewPc();var e=S(l.pc,r,n);return e})}function S(r,t,o){return e.parse(r,t,1).then(n.parse).then(i.parse).then(c.parse).then(function(e){console.log(e)})}function R(){return c.pipeThrough().then(i.pipeThrough).then(n.pipeThrough).then(e.pipeThrough)}var M=this;M.codeInput="mov ax, 0\nmov bx, 2\nl1:\nadd ax, 1\ncmp ax, bx\njl l1\nend",M.stepByStep=!1,M.codeArray=[],M.pipelineStarted=!1,M.endReached=!1,M.trapFlag=!1,M.IFModel=r,M.IDModel=t,M.EXModel=o,M.WBModel=u,M.common=s,M.doPrediction=h,M.goToNextBranchInstruction=m}angular.module("app").controller("CodeInputController",e),e.$inject=["IFService","IFModel","IDService","IDModel","EXService","EXModel","WBService","WBModel","labelService","pcService","common","$interval","speculativeService","speculativeModel","jmpInstructionService"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CodeInputController",controllerAs:"ci",templateUrl:"app/codeInput/code-input.html"};return e}angular.module("app").directive("codeInput",e),e.$inject=[]}(),function(){"use strict";function e(e,r,n,t){function i(i,o,c,u){void 0===i?(e.flush(),r.flush(),n.flush()):(i&&e.flush(),o&&r.flush(),c&&n.flush(),u&&t.flush())}function o(){return 0===e.instructionsInIF.length&&0===r.instructionsInID.length&&0===n.instructionsInEX.length&&0===t.instructionsInWB.length}function c(e){var r=null!==e.firstOperator,n=null!==e.secondOperator;return e.operation+" "+(r?e.firstOperator:"")+(n?", "+e.secondOperator:"")}var u={pipelineStarted:!1,pipelineActive:!1,flushPipeline:i,isPipelineEmpty:o,instructionToText:c};return u}angular.module("core").factory("common",e),e.$inject=["IFModel","IDModel","EXModel","WBModel"]}(),function(){"use strict";function e(e){function r(){o.jmpInstructions=["jmp","je","jz","jne","jnz","jg","jnle","jge","jnl","jl","jnge","jle","jng"],o.flagGenInstructions=["test","cmp"]}function n(e){return o.jmpInstructions.indexOf(e)!==-1}function t(e){return o.flagGenInstructions.indexOf(e)!==-1}function i(r){var n=e.flags,t={jmp:!0,je:n.ZF,jz:n.ZF,jne:!n.ZF,jnz:!n.ZF,jg:!n.ZF&&n.SF===n.OF,jnle:!n.ZF&&n.SF===n.OF,jge:n.SF===n.OF,jnl:n.SF===n.OF,jl:n.SF!==n.OF,jnge:n.SF!==n.OF,jle:n.ZF||n.SF!==n.OF,jng:n.ZF||n.SF!==n.OF};return t[r]}var o={jmpInstructions:[],isJmpInstruction:n,isFlagGenInstruction:t,checkBranchCondition:i};return r(),o}angular.module("core").factory("jmpInstructionService",e),e.$inject=["aluService"]}(),function(){"use strict";function e(){function e(e,r){var n={};n[e.toLowerCase()]=r,t.labelArray.push(n)}function r(e){var r=null;return t.labelArray.some(function(n){if(void 0!==n[e])return r=n,!0}),r[e]}function n(r){for(var n=r,t=0;t<r.length;){var i=r[t];if(i.indexOf(":")!==-1){var o=i.slice(0,i.indexOf(":"));n.splice(t,1),e(o,t)}else t++}return n}var t={labelArray:[],getAddress:r,setLabelAddress:e,setAndRemoveLabelsFromCodeArray:n};return t}angular.module("core").factory("labelService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){n.pc+=1,null!==n.overridePc&&(n.pc=n.overridePc,n.overridePc=null)}function r(e,r){var t=r?r.toString(2):n.pc.toString(2),i=t.slice(-e);return parseInt(i,2)}var n={pc:-1,branchesPredictedTaken:[],overridePc:null,setNewPc:e,getLastBitsOfPc:r};return n}angular.module("core").factory("pcService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInEX=[],r.writeBackResults=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInEX,writeBackResults:r.writeBackResults};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,nextPredictionFalse:!1,instructionsInEX:[],writeBackResults:[],flush:e};return r}angular.module("core").factory("EXModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,n,t,i,o,c,u,a,l,s,f,p,d){function v(r){return o.currentPc=r.currentPc,o.instructionsInEX=r.instructionSet,o.writeBackResults=[],P(o.instructionsInEX),I(),o.returnPromise=e.defer(),o.returnPromise.promise}function h(e,r){var c=n.checkBranchCondition(e.operation),u=t.getAddress(e.firstOperator),d=o.currentPc+r,v=(i.branchesPredictedTaken.indexOf(d),b()),h=s.getCurrentPrediction(d),m={pc:d,jmpToPc:u,delay:v,predictedValue:h?1:0,calculatedValue:c?1:0},g=f.getCopy(),I=a.formPredictedArray(a.buffer),P=parseInt(g.concat(I).join(""),2),y=f.useCor,S=p.useLht;!y&&S&&(P=i.getLastBitsOfPc(p.numOfPcBits,d));var R=p.getCopyOfLocalHistoryArrayFor(P),M=p.getLocalHistoryValue(P),O=s.getCopyOfMachine(M),j={localHistoryIndex:P,localHistoryArray:R,predictionMachineIndex:M,predictionMachineValue:O};s.updatePredictionsExceptCorelation(m.predictedValue,m.pc),l.createNewBranchBuffer(m,j),a.addingToSpeculative=!0}function m(e){var r=e.branchInfo.predictedValue,n=e.branchInfo.calculatedValue,t=e.branchInfo.pc,c=i.branchesPredictedTaken.indexOf(t);if(o.nextPredictionFalse&&(n=!n),n&&!r)return u.flushPipeline(),e.branchInfo.mispredicted=!0,e.branchInfo.mispredictionPc=e.branchInfo.jmpToPc,e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0;if(n&&r)i.branchesPredictedTaken.splice(c,1),e.branchInfo.shouldCommit=!0;else if(n||r){if(!n&&r)return u.flushPipeline(),e.branchInfo.mispredicted=!0,e.branchInfo.mispredictionPc=t+1,i.branchesPredictedTaken.splice(c,1),e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0}else e.branchInfo.shouldCommit=!0;return!1}function g(e){o.writeBackResults=S(e)}function I(){a.buffer.map(function(e,r){return e.branchInfo.delay&&(e.branchInfo.delay-=1),0===e.branchInfo.delay&&(e.branchInfo.calculated=!0,m(e),l.mergeAndCommitValues(e)),e}),0===a.buffer.length&&(a.addingToSpeculative=!1)}function b(){return d.floor(40*d.random()+4)}function P(e){return e.some(function(e,r){var t=e.operation,i=n.isJmpInstruction(t);if(i){var o=h(e,r);return o}g(e)}),o.instructionsInEX}function y(){if(o.returnPromise){var r={currentPc:o.currentPc,instructionSet:o.instructionsInEX,writeBackResults:o.writeBackResults};return o.returnPromise.resolve(r),o.returnPromise.promise}return e.resolve()}function S(e){var n=e.firstOperator,t=e.secondOperator,i=e.operation,u=r.compareAndSetFlags(n,t,i),s={currentPc:o.currentPc,register:e.firstOperator,result:u,operation:i};return a.addingToSpeculative?c.shouldWriteBack(i)&&l.addTo(n,u):o.writeBackResults.push(s),o.writeBackResults}var R={parse:v,pipeThrough:y,parseJumpInstruction:h};return R}angular.module("core").factory("EXService",e),e.$inject=["$q","aluService","jmpInstructionService","labelService","pcService","EXModel","WBService","common","speculativeModel","speculativeService","predictionMachinesService","corelationRegisterService","localHistoryTableService","Math"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInID=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInID};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,instructionsInID:[],flush:e};return r}angular.module("core").factory("IDModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r){function n(n){return r.currentPc=n.currentPc,r.instructionsInID=o(n.instructionSet),r.returnPromise=e.defer(),r.returnPromise.promise}function t(){if(r.returnPromise){var n={currentPc:r.currentPc,instructionSet:r.instructionsInID};return r.returnPromise.resolve(n),r.returnPromise.promise}return e.resolve()}function i(e){var r=e.replace(",",""),n=r.split(" "),t={operation:n[0].toLowerCase(),firstOperator:void 0===n[1]?null:n[1].toLowerCase(),secondOperator:void 0===n[2]?null:n[2].toLowerCase()};return t}function o(e){var r=[];return e.forEach(function(e){var n=i(e);r.push(n)}),r}var c={parse:n,pipeThrough:t,decodeSingleInstruction:i};return c}angular.module("core").factory("IDService",e),e.$inject=["$q","IDModel"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInIF=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInIF};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,instructionsInIF:[],flush:e};return r}angular.module("core").factory("IFModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,n,t,i,o,c){function u(n,t,i){r.currentPc=n||0,i=i||1,r.returnPromise=e.defer();var o=r.currentPc,c=r.currentPc+i;p.codeArrayInput=angular.copy(t);var u=t.slice(o,c);return a(u),r.instructionsInIF=u,r.returnPromise.promise}function a(e){for(var i=0;i<e.length;){var u=e[i],a=n.decodeSingleInstruction(u),f=i+r.currentPc,p=t.isJmpInstruction(a.operation),d=c.getCurrentPrediction(f)?1:0;if(p&&d){var v=e.length-i-1,h=s(a);if(v>0){var m=l(h,v);e.splice(i,v),e.concat(m)}o.branchesPredictedTaken.push(f),o.overridePc=h+v}i++}return e}function l(e,r){var n=e+r;return p.codeArrayInput.slice(e,n)}function s(e){var r=e.firstOperator;return i.getAddress(r)}function f(){if(r.returnPromise){var n={currentPc:r.currentPc,instructionSet:r.instructionsInIF};return r.returnPromise.resolve(n),r.returnPromise.promise}return e.resolve()}var p={currentPc:null,returnPromise:null,instructionsInIF:[],codeArrayInput:[],parse:u,pipeThrough:f};return p}angular.module("core").factory("IFService",e),e.$inject=["$q","IFModel","IDService","jmpInstructionService","labelService","pcService","predictionMachinesService"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInWB=[],r.writeBackResults=[],r.returnPromise.resolve()}var r={currentPc:null,returnPromise:null,instructionsInWB:[],writeBackResults:[],flush:e};return r}angular.module("core").factory("WBModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,n){function t(e){return n.currentPc=e.currentPc,n.instructionsInWB=e.instructionSet,n.writeBackResults=e.writeBackResults,i(e.writeBackResults),n.returnPromise=r.defer(),n.returnPromise.promise}function i(r){r.forEach(function(r){var n=r.register,t=r.result,i=r.operation;"end"===i&&(a.endReached=!0),o(i)&&e.setValueOfReg(n,t)})}function o(e){return u.indexOf(e)===-1}function c(){return n.returnPromise?(n.returnPromise.resolve(n.writeBackResults),n.returnPromise.promise):r.resolve()}var u=["cmp","end"],a={endReached:!1,parse:t,pipeThrough:c,shouldWriteBack:o};return a}angular.module("core").factory("WBService",e),e.$inject=["registerService","$q","WBModel"]}(),function(){"use strict";angular.module("core").constant("Math",window.Math)}(),function(){"use strict";function e(e){function r(r){var t=0,o=e.buffer.length,c=(o?e.buffer[o-1].valuesToCommit:0,n(r));return void 0!==i.coreRegisters[r]?t=i.coreRegisters[r]:void 0!==i.otherRegisters[r]?t=i.otherRegisters[r]:i.otherRegisters[r]=0,t=c||t}function n(r){var n=null,t=e.buffer;return t.reverse(),t.some(function(e){if(e.valuesToCommit[r])return n=e.valuesToCommit[r],!0}),t.reverse(),n}function t(e,r){return void 0!==i.coreRegisters[e]?i.coreRegisters[e]=r:i.otherRegisters[e]=r,e}var i={coreRegisters:{ax:0,bx:0,cx:0,dx:0,sp:0,bp:0,si:0,di:0},otherRegisters:{},getValueOfReg:r,setValueOfReg:t};return i}angular.module("core").factory("registerService",e),e.$inject=["speculativeModel"]}(),function(){"use strict";function e(){function e(e){var n=e||i.size;r(n)}function r(e){i.buffer=[];for(var r=0;r<e;r++)i.buffer[r]={branchInfo:{predictedValue:0},valuesToCommit:{},predictionOverrides:{}}}function n(e){i.buffer.shift(),i.buffer.push(e)}function t(e){var r=[];return e.forEach(function(e){r.push(e.branchInfo.predictedValue)}),r}var i={addingToSpeculative:!1,buffer:[],size:6,initialize:e,setMaxNumberOfBits:r,shiftWithValue:n,formPredictedArray:t};return i}angular.module("core").factory("speculativeModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,n,t,i,o,c,u,a){function l(){return 0===n.buffer.length}function s(){n.buffer=[]}function f(e,r){var t={branchInfo:e,valuesToCommit:{},predictionOverrides:r};return v(t),n.buffer[n.buffer.length-1]}function p(e,r){var t=n.buffer.length-1;n.buffer[t].valuesToCommit[e]=r}function d(e){var r=n.buffer,i=h(r);r=g(r),r.some(function(e,r){if(e.branchInfo.calculated){var n=e.branchInfo.calculatedValue;i=r,t.useCor&&t.value.push(n),e.branchInfo.shouldCommit&&P(e)}return!e.branchInfo.calculated});var o=y(r);r.splice(0,o)}function v(r){var c=(t.value.length,t.size,n.buffer.length),l=n.size;c<l?(n.buffer.push(r),t.useCor&&t.value.shift()):(a.cancel(u.pipelineInterval),window.alert("Too much! Stopping execution..."),e(function(){u.flushPipeline(),s(),t.clear(),i.clear(),o.clear(),u.pipelineActive=!1,u.pipelineStarted=!1},10))}function h(e){var r=-1;return e.some(function(e,n){return e.branchInfo.calculated&&e.branchInfo.shouldCommit&&(r=n),!e.branchInfo.shouldCommit}),r}function m(e,r){r.reverse().some(function(r){if(r===e)return!0;var n=r.predictionOverrides.localHistoryIndex,t=r.predictionOverrides.localHistoryArray,c=r.predictionOverrides.predictionMachineIndex,u=r.predictionOverrides.predictionMachineValue;i.setLocalHistoryArray(n,t),o.setPrediction(c,u)}),r.reverse();var n=e.predictionOverrides.localHistoryIndex,t=e.predictionOverrides.localHistoryArray,c=e.predictionOverrides.predictionMachineIndex,u=e.predictionOverrides.predictionMachineValue;i.setLocalHistoryArray(n,t),o.setPrediction(c,u)}function g(e){var r=null,n=null,i=0;if(e.some(function(t,o,u){if(t.branchInfo.mispredicted)return t.branchInfo.mispredicted=null,n=t.branchInfo.calculatedValue,r=o,i=t.branchInfo.pc,c.overridePc=t.branchInfo.mispredictionPc,m(t,e),!0}),null!==r){var u=e.length-(r+1);if(t.useCor)for(var a=0;a<u;a++)t.value.splice(0,0,0);e.splice(r+1,u),o.updatePredictionsExceptCorelation(n,i)}return e}function I(e){return n.buffer.some(function(r,n,t){if(r.pc===e)return t[n].calculated=!0,!0}),n.buffer}function b(e){n.buffer.some(function(r,n,t){if(r.pc===e){var i=t.length-n;return t.splice(n,i),!0}})}function P(e){var n=e.valuesToCommit;angular.forEach(n,function(e,n){r.setValueOfReg(n,e)})}function y(e){var r=e.length;return e.some(function(e,n){if(!e.branchInfo.calculated)return r=n,!0}),r}function S(){return n.buffer[n.buffer.length-1].valuesToCommit}var R={clear:s,modelIsEmpty:l,addTo:p,comfitValues:P,createNewBranchBuffer:f,mergeAndCommitValues:d,setBufferToCalculated:I,misprediction:b,getNextUncalculated:y,getLatestSpeculatedValues:S};return R}angular.module("core").factory("speculativeService",e),e.$inject=["$timeout","registerService","speculativeModel","corelationRegisterService","localHistoryTableService","predictionMachinesService","pcService","common","$interval"]}(),function(){"use strict";function e(e,r,n,t){function i(){u.corelationRegister.initializeCR()}function o(){var n=e.size,t=r.size;u.corelationRegister.setMaxNumberOfBits(u.corelationRegister.size),u.locationHistoryTable.initializeLHT(),u.predictionMachines.setMachineSize(n,t)}function c(e){var r={"true":{color:"green"},undefined:{color:"red"}};return r[e.calculated]}var u=this;u.corelationRegister=e,u.locationHistoryTable=r,u.predictionMachines=n,u.speculativeModel=t,u.updateValues=o,u.getStyleForPrediction=c,i()}angular.module("app").controller("CorelationRegisterController",e),e.$inject=["corelationRegisterService","localHistoryTableService","predictionMachinesService","speculativeModel"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CorelationRegisterController",controllerAs:"corReg",templateUrl:"app/corelationRegister/corelation-register.html"};return e}angular.module("app").directive("corelationRegister",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){var n=e||c.size;r(n)}function r(e){c.value=[];for(var r=0;r<e;r++)c.value[r]=0}function n(e){c.value.shift(),c.value.push(e)}function t(){var e=c.value.join("");return parseInt(e,2)}function i(){return angular.copy(c.value)}function o(){c.value=[],e()}var c={value:[],size:12,useCor:!0,setMaxNumberOfBits:r,shiftWithValue:n,getRegisterValue:t,initializeCR:e,getCopy:i,clear:o};return c}angular.module("app").factory("corelationRegisterService",e),e.$inject=[]}(),function(){function e(e,r,n,t,i){function o(){a.localHistoryTable.initializeLHT()}function c(r){return e.changed.indexOf(r)!==-1}function u(r){var t=n.size,i=e.size;e.setSizeOfRegisters(),a.predictionMachines.setMachineSize(t,i)}var a=this;a.localHistoryTable=e,a.predictionMachines=i,a.updateValues=u,a.checkIfChanged=c,a.corelationRegister=n,o()}angular.module("app").controller("localHistoryTableController",e),e.$inject=["localHistoryTableService","pcService","corelationRegisterService","speculativeModel","predictionMachinesService"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"localHistoryTableController",controllerAs:"lht",templateUrl:"app/localHistoryTable/local-history-table.html"};return e}angular.module("app").directive("localHistoryTable",e),e.$inject=[]}(),function(){"use strict";function e(e,r,n){function t(){}function i(t){var i=t||d.size,c=n.pow(e.size+r.size,2);d.value=[],o(c),u(i)}function o(e){for(var r=0;r<e;)d.value[r++]=[]}function c(e){var r=n.pow(2,e);o(r),d.value=d.value.map(function(r){for(var n=0;n<e;n++)r[n]=0;return r})}function u(e){d.value=d.value.map(function(r){r=[];for(var n=0;n<e;n++)r[n]=0;return r})}function a(e,r){d.localHistoryTableActive=!0,d.changed.indexOf(e)===-1&&d.changed.push(e),d.value[e].shift(),d.value[e].push(r)}function l(e){return angular.copy(d.value[e])}function s(e,r){return angular.copy(r,d.value[e])}function f(e){var r=d.value[e].join(""),n=parseInt(r,2);return n}function p(){d.value=[],d.changed=[],i()}var d={value:[],size:3,changed:[],numOfPcBits:3,useLht:!0,localHistoryTableActive:!1,setMaxNumberOfBits:c,setSizeOfRegisters:u,shiftWithValue:a,getLocalHistoryValue:f,initializeLHT:i,getCopyOfLocalHistoryArrayFor:l,setLocalHistoryArray:s,clear:p};return t(),d}angular.module("app").factory("localHistoryTableService",e),e.$inject=["corelationRegisterService","speculativeModel","Math"]}(),function(){"use strict";function e(e,r,n){function t(){o.predictionMachines.setMachineSize()}function i(r){return e.changed.indexOf(r)!==-1}var o=this;o.numberOfMachines=e.numOfMachines,o.predictionMachines=e,o.checkIfChanged=i,t()}angular.module("app").controller("PredictionMachinesController",e),e.$inject=["predictionMachinesService","corelationRegisterService","localHistoryTableService"]}(),function(){function e(){var e={restrict:"E",controller:"PredictionMachinesController",controllerAs:"pm",templateUrl:"app/predictionMachines/prediction-machines.html"};return e}angular.module("app").directive("predictionMachines",e),e.$inject=[]}(),function(){"use strict";function e(e,r,n,t){function i(r,t){r=r||e.size,t=t||n.size,v.numOfMachines=Math.pow(2,r+t),v.value=[];for(var i=0;i<v.numOfMachines;)v.value[i++]=[1,0]}function o(e,r){var n=parseInt(v.value[e].join(""),2),t=Math.pow(2,2)-1;v.changed.indexOf(e)===-1&&v.changed.push(e),0===r&&n>0?n-=1:1===r&&n<t&&(n+=1);var i=n.toString(2);return v.value[e]=u(i,v.sizeOfMachines).split(""),v.value}function c(i){var o,c,u,a,l,s,f=e.useCor,p=n.useLht;return f&&!p?(o=e.getCopy(),c=t.formPredictedArray(t.buffer),a=parseInt(o.concat(c).join(""),2),l=v.value[a].join(""),s=parseInt(l,2),s>=2):!f&&p?(a=r.getLastBitsOfPc(n.numOfPcBits,i),l=v.value[a].join(""),s=parseInt(l,2),s>=2):(o=e.getCopy(),c=t.formPredictedArray(t.buffer),u=parseInt(o.concat(c).join(""),2),a=n.getLocalHistoryValue(u),l=v.value[a].join(""),s=parseInt(l,2),s>=2)}function u(e,r){for(var n="",t=0;t<r;t++)n+="0";return(n+e).slice(-r)}function a(e,r){v.value[e]=r}function l(i){var c=e.useCor,u=n.useLht,a=e.getCopy(),l=t.formPredictedArray(t.buffer),s=parseInt(a.concat(l).join(""),2),f=n.getLocalHistoryValue(s);v.predictionTableActive=!0,c&&!u?f=s:!c&&u&&(s=r.getLastBitsOfPc(n.numOfPcBits),f=n.getLocalHistoryValue(s)),o(f,i),u&&n.shiftWithValue(s,i),c&&e.shiftWithValue(i)}function s(i,c){var u=e.useCor,a=n.useLht,l=e.getCopy(),s=t.formPredictedArray(t.buffer),f=parseInt(l.concat(s).join(""),2),p=n.getLocalHistoryValue(f);v.predictionTableActive=!0,u&&!a?p=f:!u&&a&&(f=r.getLastBitsOfPc(n.numOfPcBits,c),p=n.getLocalHistoryValue(f)),o(p,i),a&&n.shiftWithValue(f,i),o(p,i)}function f(e){return angular.copy(v.value[e])}function p(e){var r=v.value.join("");return parseInt(r,2)}function d(){v.value=[],v.changed=[],i()}var v={numOfMachines:null,sizeOfMachines:2,value:[],changed:[],predictionTableActive:!1,setMachineSize:i,setPrediction:a,getCurrentPrediction:c,updatePredictions:l,updatePredictionsExceptCorelation:s,getCopyOfMachine:f,getValueOfMachine:p,clear:d};return v}angular.module("app").factory("predictionMachinesService",e),e.$inject=["corelationRegisterService","pcService","localHistoryTableService","speculativeModel"]}();
>>>>>>> 59f918dff7ab39054c09bbc637c5961488431b80
