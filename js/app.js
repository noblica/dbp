!function(){"use strict";angular.module("test",[])}(),function(){"use strict";function e(e,r){function t(e){e.go("app.home")}e.state("app",{"abstract":!0,controller:"AppController",controllerAs:"app",template:"<ui-view></ui-view>"}).state("app.home",{url:"",controller:"TestController",controllerAs:"vm",templateUrl:"app/TestModule/test.html"}),r.when("",t).when("/",t).otherwise("/error/404"),t.$inject=["$state"]}angular.module("app",["ui.router","ui.bootstrap","ngAnimate","core","pipeline","test"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("core",[])}(),function(){"use strict";angular.module("pipeline",[])}(),function(){"use strict";function e(e){function r(){}function t(e){n.localHistoryCollapse=!n.localHistoryCollapse}var n=this;n.corelationRegisterCollapse=!1,n.localHistoryCollapse=!0,n.predictionMachinesCollapse=!0,n.predictionMachinesService=e,n.toggleLocalHistory=t,r()}angular.module("test").controller("TestController",e),e.$inject=["predictionMachinesService"]}(),function(){"use strict";function e(){function e(){console.log("Layout controller loaded!")}e()}angular.module("app").controller("AppController",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(){p.flags={ZF:!1,CF:!1,OF:!1,SF:!1}}function i(n,i){isNaN(n)&&(p.aRegName=n),p.a=t.getValueFromSpeculative(n),null===p.a&&(p.a=r.getValueOfReg(n)),null===p.a&&(p.a=e.getValueOfReg(n)),p.b=void 0!==Number(i)?Number(i):p.b,isNaN(p.b)&&(p.bRegName=i,p.b=t.getValueFromSpeculative(i),null===p.b&&(p.b=r.getValueOfReg(i)),null===p.b&&(p.b=e.getValueOfReg(i)))}function o(e,r,t){function n(){return y=p.b}function o(){return y=p.a+p.b,s(!1),d(!1),Math.abs(y)>p.maxValue&&(s(!0),y=a(y)),j=u(y),c(M,F,j)&&d(!0),y}function v(){return s(!1),d(!1),l(!1),y=a(p.a-p.b),console.log(p.a+"-"+p.b),p.b>p.a&&s(!0),p.b===p.a&&l(!0),j=u(y),c(M,F,j)&&d(!0),y}function h(){return s(!1),d(!1),l(!1),y=p.a*p.b,0===y&&l(!0),Math.abs(y)>p.maxValue&&(s(!0),y=a(y)),j=u(y),c(M,F,j)&&d(!0),y}function m(){return d(!1),y=p.a/p.b,j===1/0&&d(!0),y}function g(){return y=p.a&p.b,f(!!u(y)),y}function I(){return y=p.a|p.b,f(!!u(y)),y}function b(){return y=p.a^p.b,f(!!u(y)),y}function P(){return l(!1),f(!1),y=p.a&p.b,0===y&&l(!0),f(!!u(y)),y}function S(){return y=~p.a}function C(){console.log("end reached!")}i(e,r);var y=p.cmpResult,M=u(p.a),F=u(p.b),j=null,x={mov:n,add:o,sub:v,cmp:v,mul:h,div:m,and:g,or:I,xor:b,test:P,not:S,end:C};return p.cmpResult=x[t](),p.cmpResult}function c(e,r,t){return e===r&&t!==e}function u(e){var r=p.bitSize,t=a(e),n=t.toString(2),i=Number(n.split("").reverse()[r]);return i?i:0}function a(e){return Number(e)&p.maxValue}function l(e){return p.flags.ZF=void 0===e?0===p.cmpResult:e,p.flags}function s(e){return p.flags.CF=void 0===e?p.flags.CF:e,p.flags}function d(e){return p.flags.OF=e,void 0===e&&(p.flags.OF=void 0===e?p.flags.OF:e),p.flags}function f(e){return p.flags.SF=e||p.cmpResult<0||p.cmpResult>p.maxValue,p.flags}var p={flags:{ZF:!1,CF:!1,OF:!1,SF:!1},a:0,aRegName:"",b:0,bRegName:"",cmpResult:0,maxValue:Math.pow(2,16)-1,maxValueSigned:Math.pow(2,15)-1,bitSize:15,compareAndSetFlags:o,resetFlags:n};return p}angular.module("app").factory("aluService",e),e.$inject=["registerService","WBService","speculativeService"]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a,l,s,d,f,p,v,h,m,g){function I(e){var r=e.split("\n"),t=y(r);f.buffer=[],x.codeArray=a.setAndRemoveLabelsFromCodeArray(t),s.pipelineStarted=!0,s.predictionEventFlag=!1,l.pc=-1,s.forceStop=!1,c.endReached=!1,v.resetFlags(),s.currentPredictionState=h.predicting,l.setNewPc(),F(l.pc,x.codeArray)}function b(e){var r={1:function(e){1!==x.previousState&&(x.previousState=1,g.alert("Going to the next flag generating/jump instructions")),P(e)},2:function(){2!==x.previousState&&(x.previousState=2,g.alert("Undoing mispredictions, one by one")),d.restorePredictions()},3:function(){3!==x.previousState&&(x.previousState=3,g.alert("Commiting the misprediction")),d.commitMisprediction(),d.checkForCalculatedPredictions()?s.currentPredictionState=h.commitCorrectPrediction:s.currentPredictionState=h.predicting},4:function(){4!==x.previousState&&(x.previousState=4,g.alert("Commiting the correctly made predictions")),d.commitCorrectPredictions()}};r[s.currentPredictionState](e)}function P(e){do M(l.pc,e);while(!C(e)&&!S()&&!s.predictionEventFlag);s.predictionEventFlag=!1,d.setNewPredictionState(),C(e)&&(s.removePredictedClassOnEnd(),s.resetLastChangedIndexes(),s.flushPipeline(),m.clear(),d.clear(),s.flushPipeline(!1,!1,!1,!0),s.pipelineStarted=!1,s.pipelineActive=!1,g.alert("Finished!"))}function S(){return o.instructionsInEX.some(function(e){return p.isJmpInstruction(e.operation)||p.isFlagGenInstruction(e.operation)})}function C(e){var r=s.isPipelineEmpty(),t=d.modelIsEmpty(),n=!l.overridePc,i=s.forceStop;return r&&t&&n||i}function y(e){var r=e.filter(function(e){return""!==e});return r}function M(e,r,t){j(),l.setNewPc(),F(l.pc,r,t)}function F(r,n,o){e.parse(r,n,1),t.parse(),i.parse(),c.parse()}function j(){c.pipeThrough(),i.pipeThrough(),t.pipeThrough(),e.pipeThrough()}var x=this;x.codeInput="mov ax, 0\nmov bx, 3\nmov cx, 5\nloop-l1:\nadd ax, 1\nmov dx, 0\nloop-l2:\nadd dx, ax\ncmp dx, cx\njl loop-l2\nadd cx, ax\ncmp ax, bx\njl loop-l1\nend",x.codeArray=[],x.pipelineStarted=!1,x.endReached=!1,x.trapFlag=!1,x.loopCounter=m.counter,x.IFModel=r,x.IDModel=n,x.EXModel=o,x.WBModel=u,x.common=s,x.previousState=-1,x.doPrediction=I,x.goToNextBranchInstruction=b}angular.module("app").controller("CodeInputController",e),e.$inject=["IFService","IFModel","IDService","IDModel","EXService","EXModel","WBService","WBModel","labelService","pcService","common","speculativeService","speculativeModel","jmpInstructionService","aluService","allPredictorStates","loopCounterService","$window"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CodeInputController",controllerAs:"ci",templateUrl:"app/codeInput/code-input.html"};return e}angular.module("app").directive("codeInput",e),e.$inject=[]}(),function(){"use strict";function e(e){function r(e){var r={name:e,count:1};a.counter.push(r)}function t(e){var r=null;return a.counter.some(function(t,n){if(t.name===e)return r=n,!0}),r}function n(e,r){var t={1:function(e){return e+1},0:function(e){return 0}},n=a.counter[e].count;a.counter[e].count=t[r](n),0===a.counter[e].count&&a.counter.splice(e,1)}function i(e,r){var t=a.checkIfLoop(e),n=null;null!==t&&(n=a.getLoopIndex(t),null!==n?a.updateLoopCount(n,r):1===r&&a.createCounter(t))}function o(r){var t=e.getLabelName(r),n=null;return null!==t&&(n=c(t)),n}function c(e){var r="loop-",t="";return e.substring(0,5)===r&&(t=e.substring(5)),t}function u(){a.counter.splice(0,a.counter.length)}var a={counter:[],createCounter:r,getLoopIndex:t,updateLoopCount:n,checkAndHandleLoopLabelPc:i,checkIfLoop:o,clear:u};return a}angular.module("app").factory("loopCounterService",e),e.$inject=["labelService"]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u){function a(i,o,c,u){void 0===i?(e.flush(),r.flush(),t.flush()):(i&&e.flush(),o&&r.flush(),c&&t.flush(),u&&n.flush())}function l(){return 0===e.instructionsInIF.length&&0===r.instructionsInID.length&&0===t.instructionsInEX.length&&0===n.instructionsInWB.length}function s(e){var r=null!==e.firstOperator,t=null!==e.secondOperator;return e.operation+" "+(r?e.firstOperator:"")+(t?", "+e.secondOperator:"")}function d(){i.lastChangedIndex=null,o.lastChangedIndex=null,c.lastChangedIndex=null,u.lastChangedIndex=null}function f(){p(c.value),p(u.value)}function p(e){return e.map(function(e){return e.predicted=!1,e}),e}var v={pipelineStarted:!1,pipelineActive:!1,removingMispredctions:!1,currentPredictionState:null,flushPipeline:a,isPipelineEmpty:l,instructionToText:s,predictionEventFlag:!1,removePredictedClassOnEnd:f,resetLastChangedIndexes:d};return v}angular.module("core").factory("common",e),e.$inject=["IFModel","IDModel","EXModel","WBModel","corelationRegisterService","speculativeModel","localHistoryTableService","predictionMachinesService"]}(),function(){"use strict";var e={predicting:1,undoMisprediction:2,commitMisprediction:3,commitCorrectPrediction:4};angular.module("core").constant("allPredictorStates",e)}(),function(){"use strict";function e(e){function r(){o.jmpInstructions=["jmp","je","jz","jne","jnz","jg","jnle","jge","jnl","jl","jnge","jle","jng"],o.flagGenInstructions=["test","cmp"]}function t(e){return o.jmpInstructions.indexOf(e)!==-1}function n(e){return o.flagGenInstructions.indexOf(e)!==-1}function i(r){var t=e.flags,n={jmp:!0,je:t.ZF,jz:t.ZF,jne:!t.ZF,jnz:!t.ZF,jg:!t.ZF&&t.SF===t.OF,jnle:!t.ZF&&t.SF===t.OF,jge:t.SF===t.OF,jnl:t.SF===t.OF,jl:t.SF!==t.OF,jnge:t.SF!==t.OF,jle:t.ZF||t.SF!==t.OF,jng:t.ZF||t.SF!==t.OF};return n[r]}var o={jmpInstructions:[],isJmpInstruction:t,isFlagGenInstruction:n,checkBranchCondition:i};return r(),o}angular.module("core").factory("jmpInstructionService",e),e.$inject=["aluService"]}(),function(){"use strict";function e(){function e(e,r){var t={};t[e.toLowerCase()]=r,i.labelArray.push(t)}function r(e){var r=null;return i.labelArray.some(function(t){if(void 0!==t[e])return r=t,!0}),r[e]}function t(e){var r=null;return i.labelArray.some(function(t){for(var n in t)t.hasOwnProperty(n)&&t[n]===e&&(r=n)}),r}function n(r){for(var t=r,n=0;n<r.length;){var i=r[n];if(i.indexOf(":")!==-1){var o=i.slice(0,i.indexOf(":"));t.splice(n,1),e(o,n)}else n++}return t}var i={labelArray:[],getAddress:r,getLabelName:t,setLabelAddress:e,setAndRemoveLabelsFromCodeArray:n};return i}angular.module("core").factory("labelService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){r.pc+=1,null!==r.overridePc&&(r.pc=r.overridePc,r.overridePc=null)}var r={pc:-1,branchesPredictedTaken:[],overridePc:null,setNewPc:e};return r}angular.module("core").factory("pcService",e),e.$inject=[]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInEX=[],r.writeBackResults=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInEX,writeBackResults:r.writeBackResults};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,nextPredictionFalse:!1,instructionsInEX:[],writeBackResults:[],flush:e};return r}angular.module("core").factory("EXModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a,l,s,d,f,p,v,h){function m(r){return o.writeBackResults=[],C(o.instructionsInEX),P(),o.returnPromise=e.defer(),o.returnPromise.promise}function g(e,r){var c=t.checkBranchCondition(e.operation),u=n.getAddress(e.firstOperator),a=o.currentPc+r,v=(i.branchesPredictedTaken.indexOf(a),S()),h=d.getCurrentPrediction(a),m={pc:a,jmpToPc:u,delay:v,predictedValue:h?1:0,calculatedValue:c?1:0},g=f.getCopy(),I=l.formPredictedArray(l.buffer),b=(parseInt(g.concat(I).join(""),2),a),P=(f.useCor,p.useLht,p.getCopyOfLocalHistoryArrayFor(b)),C=g.concat(I),y=parseInt(C.concat(P).join(""),2),M=d.getCopyOfMachine(y),F={localHistoryIndex:b,localHistoryArray:P,predictionMachineIndex:y,predictionMachineValue:M};d.updatePredictionsExceptCorelation(m.predictedValue,m.pc),s.createNewBranchBuffer(m,F),l.addingToSpeculative=!0}function I(e){var r=e.branchInfo.predictedValue,t=e.branchInfo.calculatedValue,n=e.branchInfo.pc,c=i.branchesPredictedTaken.indexOf(n);if(o.nextPredictionFalse&&(t=!t),t&&!r)return a.flushPipeline(),e.branchInfo.mispredicted=!0,e.branchInfo.mispredictionPc=e.branchInfo.jmpToPc,e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0;if(t&&r)i.branchesPredictedTaken.splice(c,1),e.branchInfo.shouldCommit=!0;else if(t||r){if(!t&&r)return a.flushPipeline(),e.branchInfo.mispredicted=!0,e.branchInfo.mispredictionPc=n+1,i.branchesPredictedTaken.splice(c,1),e.branchInfo.predictedValue=e.branchInfo.calculatedValue,!0}else e.branchInfo.shouldCommit=!0;return!1}function b(e){o.writeBackResults=M(e)}function P(){l.buffer.map(function(e,r){return e.branchInfo.delay&&(e.branchInfo.delay-=1,0===e.branchInfo.delay&&(l.lastChangedIndex=r,e.branchInfo.calculated=!0,I(e),a.predictionEventFlag=!0)),e}),0===l.buffer.length&&(l.addingToSpeculative=!1)}function S(){return h.floor(20*h.random()+4)}function C(e){return e.some(function(e,r){var n=e.operation,i=t.isJmpInstruction(n),o=t.isFlagGenInstruction(n);if((i||o)&&(a.predictionEventFlag=!0),i){var c=g(e,r);return c}b(e)}),o.instructionsInEX}function y(){if(o.returnPromise){var r={currentPc:o.currentPc,instructionSet:o.instructionsInEX,writeBackResults:o.writeBackResults};return o.returnPromise.resolve(r),c.currentPc=r.currentPc,c.instructionsInWB=r.instructionSet,c.writeBackResults=r.writeBackResults,o.returnPromise.promise}return e.resolve()}function M(e){var t=e.firstOperator,n=e.secondOperator,i=e.operation,c=r.compareAndSetFlags(t,n,i),a={currentPc:o.currentPc,register:e.firstOperator,result:c,operation:i};return l.addingToSpeculative?u.shouldWriteBack(i)&&s.addTo(t,c):o.writeBackResults.push(a),o.writeBackResults}var F={parse:m,pipeThrough:y,parseJumpInstruction:g};return F}angular.module("core").factory("EXService",e),e.$inject=["$q","aluService","jmpInstructionService","labelService","pcService","EXModel","WBModel","WBService","common","speculativeModel","speculativeService","predictionMachinesService","corelationRegisterService","localHistoryTableService","loopCounterService","Math"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInID=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInID};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,instructionsInID:[],flush:e};return r}angular.module("core").factory("IDModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(t){return r.instructionsInID=c(r.instructionsInID),r.returnPromise=e.defer(),r.returnPromise.promise}function i(){if(r.returnPromise){var n={currentPc:r.currentPc,instructionSet:r.instructionsInID};return r.returnPromise.resolve(n),t.currentPc=n.currentPc,t.instructionsInEX=n.instructionSet,r.returnPromise.promise}return e.resolve()}function o(e){var r=e.replace(",",""),t=r.split(" "),n={operation:t[0].toLowerCase(),firstOperator:void 0===t[1]?null:t[1].toLowerCase(),secondOperator:void 0===t[2]?null:t[2].toLowerCase()};return n}function c(e){var r=[];return e.forEach(function(e){var t=o(e);r.push(t)}),r}var u={parse:n,pipeThrough:i,decodeSingleInstruction:o};return u}angular.module("core").factory("IDService",e),e.$inject=["$q","IDModel","EXModel"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInIF=[];var e={currentPc:r.currentPc,instructionSet:r.instructionsInIF};r.returnPromise.resolve(e)}var r={currentPc:null,returnPromise:null,instructionsInIF:[],flush:e};return r}angular.module("core").factory("IFModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a){function l(t,n,i){r.currentPc=t||0,i=i||1,r.returnPromise=e.defer();var o=r.currentPc,c=r.currentPc+i;v.codeArrayInput=angular.copy(n);var u=n.slice(o,c);return s(u),r.instructionsInIF=u,a.checkAndHandleLoopLabelPc(t,1),r.returnPromise.promise}function s(e){for(var t=0;t<e.length;){var o=e[t],a=n.decodeSingleInstruction(o),l=t+r.currentPc,s=i.isJmpInstruction(a.operation),p=u.getCurrentPrediction(l)?1:0;if(s&&p){var v=e.length-t-1,h=f(a);if(v>0){var m=d(h,v);e.splice(t,v),e.concat(m)}c.branchesPredictedTaken.push(l),c.overridePc=h+v}t++}return e}function d(e,r){var t=e+r;return v.codeArrayInput.slice(e,t)}function f(e){var r=e.firstOperator;return o.getAddress(r)}function p(){if(r.returnPromise){var n={currentPc:r.currentPc,instructionSet:r.instructionsInIF};return r.returnPromise.resolve(n),t.currentPc=n.currentPc,t.instructionsInID=n.instructionSet,r.returnPromise.promise}return e.resolve()}var v={currentPc:null,returnPromise:null,instructionsInIF:[],codeArrayInput:[],parse:l,pipeThrough:p};return v}angular.module("core").factory("IFService",e),e.$inject=["$q","IFModel","IDModel","IDService","jmpInstructionService","labelService","pcService","predictionMachinesService","loopCounterService"]}(),function(){"use strict";function e(){function e(){r.currentPc=0,r.instructionsInWB=[],r.writeBackResults=[],r.returnPromise.resolve()}var r={currentPc:null,returnPromise:null,instructionsInWB:[],writeBackResults:[],flush:e};return r}angular.module("core").factory("WBModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(e){return i(t.writeBackResults),t.returnPromise=r.defer(),t.returnPromise.promise}function i(r){r.forEach(function(r){var t=r.register,n=r.result,i=r.operation;"end"===i&&(s.endReached=!0),c(i)&&e.setValueOfReg(t,n)})}function o(e){t.writeBackResults=t.writeBackResults.filter(function(r){return r.register!==e})}function c(e){return l.indexOf(e)===-1}function u(){return t.returnPromise?(t.returnPromise.resolve(t.writeBackResults),t.returnPromise.promise):r.resolve()}function a(e){var r=null;return t.writeBackResults.some(function(t){if(e===t.register)return r=t.result,!0}),r}var l=["cmp","end"],s={endReached:!1,parse:n,pipeThrough:u,shouldWriteBack:c,getValueOfReg:a,removeFromWriteback:o};return s}angular.module("core").factory("WBService",e),e.$inject=["registerService","$q","WBModel"]}(),function(){"use strict";angular.module("core").constant("Math",window.Math)}(),function(){"use strict";function e(e){function r(e){var r=0;return void 0!==n.coreRegisters[e]?r=n.coreRegisters[e]:void 0!==n.otherRegisters[e]?r=n.otherRegisters[e]:n.otherRegisters[e]=0,r}function t(e,r){return void 0!==n.coreRegisters[e]?n.coreRegisters[e]=r:n.otherRegisters[e]=r,e}var n={coreRegisters:{ax:0,bx:0,cx:0,dx:0,sp:0,bp:0,si:0,di:0},otherRegisters:{},getValueOfReg:r,setValueOfReg:t};return n}angular.module("core").factory("registerService",e),e.$inject=["speculativeModel"]}(),function(){"use strict";function e(){function e(e){var t=e||i.size;r(t)}function r(e){i.buffer=[];for(var r=0;r<e;r++)i.buffer[r]={branchInfo:{predictedValue:0},valuesToCommit:{},predictionOverrides:{}}}function t(e){i.buffer.shift(),i.buffer.push(e)}function n(e){var r=[];return e.forEach(function(e){r.push(e.branchInfo.predictedValue)}),r}var i={addingToSpeculative:!1,buffer:[],size:6,lastChangeIndex:null,initialize:e,setMaxNumberOfBits:r,shiftWithValue:t,formPredictedArray:n,limitWasReached:!1};return i}angular.module("core").factory("speculativeModel",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n,i,o,c,u,a,l,s,d){function f(){return 0===r.buffer.length}function p(){r.buffer=[]}function v(e,t){var n={branchInfo:e,valuesToCommit:{},predictionOverrides:t};return I(n),r.buffer[r.buffer.length-1]}function h(e,t){var n=r.buffer.length-1;r.buffer[n].valuesToCommit[e]=t}function m(){var e=r.buffer;return e[0]&&e[0].branchInfo.calculated}function g(){var e=r.buffer,o=e[0];if(o&&o.branchInfo.calculated){var a=o.branchInfo.calculatedValue,l=o.predictionOverrides,s=l.localHistoryIndex;n.predictionComitted(s);var f=l.predictionMachineIndex;i.predictionComitted(f),t.useCor&&t.value.push(a),o.branchInfo.shouldCommit&&x(o),r.lastChangedIndex=null,t.lastChangedIndex=t.value.length-1,e.splice(0,1),r.limitWasReached&&(d.alert("Predictions no longer at the limit. New predictions can now be pushed."),r.limitWasReached=!1,c.predictionEventFlag=!0)}else d.alert("No more predictions to commit!"),c.currentPredictionState=u.predicting,t.lastChangedIndex=null}function I(e){var n=(t.value.length,t.size,r.buffer.length),i=r.size;if(n<i){if(t.lastChangedIndex=null,r.lastChangedIndex=r.buffer.length,r.buffer.push(e),t.useCor){var o=t.value.shift();t.pushedOut.push(o)}}else d.alert("Unable to push prediction, because prediction limit has been reached."),r.limitWasReached=!0,c.predictionEventFlag=!0}function b(){var e=r.buffer,t=T.mispredictedInfo.mispredictedIndex,n=e[t],i=null;i=e[e.length-1],i&&i!==n?(P(i),M(),e.pop(),r.lastChangedIndex=e.length-1):(P(n),c.currentPredictionState=u.commitMisprediction,r.lastChangedIndex=null,d.alert("Finished misprediction recovery."))}function P(e){var r=e.predictionOverrides.localHistoryIndex,t=e.predictionOverrides.localHistoryArray,o=e.predictionOverrides.predictionMachineIndex,c=e.predictionOverrides.predictionMachineValue,u=e.branchInfo.jmpToPc;n.setLocalHistoryArray(r,t),n.lastChangedIndex=r,i.setPrediction(o,c),i.lastChangedIndex=o,a.checkAndHandleLoopLabelPc(u,e.branchInfo.calculatedValue)}function S(){r.buffer;c.currentPredictionState=u.predicting,T.mispredictedInfo=C(),null!==T.mispredictedInfo.mispredictedIndex?c.currentPredictionState=u.undoMisprediction:m()&&(c.currentPredictionState=u.commitCorrectPrediction)}function C(){var e=r.buffer,t={mispredictedIndex:null,updateWith:null,pcToUse:0,predictionOverrides:{}};return e.some(function(e,r,n){if(e.branchInfo.mispredicted)return c.removingMispredictions=!0,e.branchInfo.mispredicted=null,t={updateWith:e.branchInfo.calculatedValue,mispredictedIndex:r,pcToUse:e.branchInfo.pc,predictionOverrides:e.predictionOverrides},o.overridePc=e.branchInfo.mispredictionPc,!0}),t}function y(){var e=r.buffer,t=T.mispredictedInfo,n=t.mispredictedIndex,o=t.updateWith,c=t.pcToUse,u=t.predictionOverrides;return r.lastChangedIndex=n,null!==n&&i.updatePredictionsExceptCorelation(o,c,u),e}function M(){var e=t.pushedOut.pop();t.value.splice(0,0,e)}function F(e){var t=null,n=r.buffer;return n.reverse(),n.some(function(r){if(void 0!==r.valuesToCommit[e])return t=r.valuesToCommit[e],!0}),n.reverse(),t}function j(e){return r.buffer.some(function(r,t,n){if(r.pc===e)return n[t].calculated=!0,!0}),r.buffer}function x(r){var t=r.valuesToCommit;angular.forEach(t,function(r,t){e.setValueOfReg(t,r)})}function R(e){var r=e.length;return e.some(function(e,t){if(!e.branchInfo.calculated)return r=t,!0}),r}function O(){return r.buffer[r.buffer.length-1].valuesToCommit}var T={clear:p,modelIsEmpty:f,addTo:h,comfitValues:x,createNewBranchBuffer:v,setBufferToCalculated:j,getNextUncalculated:R,getLatestSpeculatedValues:O,commitCorrectPredictions:g,restorePredictions:b,commitMisprediction:y,setNewPredictionState:S,checkForCalculatedPredictions:m,getValueFromSpeculative:F,mispredictedInfo:{}};return T}angular.module("core").factory("speculativeService",e),e.$inject=["registerService","speculativeModel","corelationRegisterService","localHistoryTableService","predictionMachinesService","pcService","common","allPredictorStates","loopCounterService","WBService","$interval","$window"]}(),function(){"use strict";function e(e,r,t,n){function i(){u.corelationRegister.initializeCR()}function o(){var t=e.size,n=r.size;u.corelationRegister.setMaxNumberOfBits(u.corelationRegister.size),u.locationHistoryTable.initializeLHT(),u.predictionMachines.setMachineSize(t,n)}function c(e){var r={"true":{color:"green"},undefined:{color:"red"}};return r[e.calculated]}var u=this;u.corelationRegister=e,u.locationHistoryTable=r,u.predictionMachines=t,u.speculativeModel=n,u.updateValues=o,u.getStyleForPrediction=c,i()}angular.module("app").controller("CorelationRegisterController",e),e.$inject=["corelationRegisterService","localHistoryTableService","predictionMachinesService","speculativeModel"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"CorelationRegisterController",controllerAs:"corReg",templateUrl:"app/corelationRegister/corelation-register.html"};return e}angular.module("app").directive("corelationRegister",e),e.$inject=[]}(),function(){"use strict";function e(){function e(e){var t=e||c.size;r(t)}function r(e){c.value=[];for(var r=0;r<e;r++)c.value[r]=0}function t(e){var r=c.value.shift();c.value.push(e),c.pushedOut.push(r)}function n(){var e=c.value.join("");return parseInt(e,2)}function i(){return angular.copy(c.value)}function o(){c.value=[],e()}var c={value:[],pushedOut:[],size:12,useCor:!0,lastChangedIndex:null,setMaxNumberOfBits:r,shiftWithValue:t,getRegisterValue:n,initializeCR:e,getCopy:i,clear:o};return c}angular.module("app").factory("corelationRegisterService",e),e.$inject=[]}(),function(){function e(e,r,t,n,i){function o(){a.localHistoryTable.initializeLHT()}function c(r){return e.changed.indexOf(r)!==-1}function u(r){var n=t.size,i=e.size;e.setSizeOfRegisters(),a.predictionMachines.setMachineSize(n,i)}var a=this;a.localHistoryTable=e,a.predictionMachines=i,a.updateValues=u,a.checkIfChanged=c,a.corelationRegister=t,o()}angular.module("app").controller("localHistoryTableController",e),e.$inject=["localHistoryTableService","pcService","corelationRegisterService","speculativeModel","predictionMachinesService"]}(),function(){"use strict";function e(){var e={restrict:"E",controller:"localHistoryTableController",controllerAs:"lht",templateUrl:"app/localHistoryTable/local-history-table.html"};return e}angular.module("app").directive("localHistoryTable",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t){function n(){}function i(n){var i=n||v.size,c=t.pow(e.size+r.size,2);v.value=[],o(c),u(i)}function o(e){for(var r=0;r<e;)v.value[r++]={predicted:!1,bits:[]}}function c(e){var r=t.pow(2,e);o(r),v.value=v.value.map(function(r){for(var t=0;t<e;t++)r.bits[t]=0;return r})}function u(e){v.value=v.value.map(function(r){r.bits=[];for(var t=0;t<e;t++)r.bits[t]=0;return r})}function a(e,r){v.localHistoryTableActive=!0,v.lastChangedIndex=e,v.changed.indexOf(e)===-1&&v.changed.push(e),v.value[e].predicted=!0,v.value[e].bits.shift(),v.value[e].bits.push(r)}function l(e){return angular.copy(v.value[e].bits)}function s(e,r){return angular.copy(r,v.value[e].bits)}function d(e){var r=v.value[e].bits.join(""),t=parseInt(r,2);return t}function f(e){v.value[e].predicted=!1}function p(){v.value=[],v.changed=[],i()}var v={value:[],size:3,changed:[],useLht:!0,localHistoryTableActive:!1,lastChangedIndex:-1,setMaxNumberOfBits:c,setSizeOfRegisters:u,shiftWithValue:a,getLocalHistoryValue:d,initializeLHT:i,getCopyOfLocalHistoryArrayFor:l,setLocalHistoryArray:s,predictionComitted:f,clear:p};return n(),v}angular.module("app").factory("localHistoryTableService",e),e.$inject=["corelationRegisterService","speculativeModel","Math"]}(),function(){"use strict";function e(e,r,t){function n(){o.predictionMachines.setMachineSize()}function i(r){return e.changed.indexOf(r)!==-1}var o=this;o.numberOfMachines=e.numOfMachines,o.predictionMachines=e,o.checkIfChanged=i,n()}angular.module("app").controller("PredictionMachinesController",e),e.$inject=["predictionMachinesService","corelationRegisterService","localHistoryTableService"]}(),function(){function e(){var e={restrict:"E",controller:"PredictionMachinesController",controllerAs:"pm",templateUrl:"app/predictionMachines/prediction-machines.html"};return e}angular.module("app").directive("predictionMachines",e),e.$inject=[]}(),function(){"use strict";function e(e,r,t,n){function i(r,n){r=r||e.size,n=n||t.size,h.numOfMachines=Math.pow(2,r+n),h.value=[];for(var i=0;i<h.numOfMachines;)h.value[i++]={predicted:!1,bits:[1,0]}}function o(e,r){var t=parseInt(h.value[e].bits.join(""),2),n=Math.pow(2,2)-1;h.lastChangedIndex=e,h.changed.indexOf(e)===-1&&h.changed.push(e),0===r&&t>0?t-=1:1===r&&t<n&&(t+=1);var i=t.toString(2);return h.value[e].predicted=!0,h.value[e].bits=u(i,h.sizeOfMachines).split(""),h.value}function c(r){var i,o,c,u,a,l,s,d,f=e.useCor,p=t.useLht;return f&&!p?(i=e.getCopy(),c=n.formPredictedArray(n.buffer),l=parseInt(i.concat(c).join(""),2),s=h.value[l].bits.join(""),d=parseInt(s,2),d>=2):!f&&p?(u=r,l=t.getLocalHistoryValue(u),s=h.value[l].bits.join(""),d=parseInt(s,2),d>=2):(i=e.getCopy(),c=n.formPredictedArray(n.buffer),u=r,a=t.getCopyOfLocalHistoryArrayFor(u),o=i.concat(c),l=parseInt(o.concat(a).join(""),2),s=h.value[l].bits.join(""),d=parseInt(s,2),d>=2)}function u(e,r){for(var t="",n=0;n<r;n++)t+="0";return(t+e).slice(-r)}function a(e,r){h.value[e].bits=r}function l(i){var c=e.useCor,u=t.useLht,a=e.getCopy(),l=n.formPredictedArray(n.buffer),s=r.pc,d=t.getCopyOfLocalHistoryArrayFor(s),f=a.concat(l),p=parseInt(f.concat(d).join(""),2);h.predictionTableActive=!0,c&&!u?p=parseInt(a.concat(l).join(""),2):!c&&u&&(s=r.pc,p=t.getLocalHistoryValue(s)),o(p,i),u&&t.shiftWithValue(s,i),c&&e.shiftWithValue(i)}function s(r,i,c){var u=e.useCor,a=t.useLht,l=e.getCopy(),s=n.formPredictedArray(n.buffer),d=parseInt(l.concat(s).join(""),2),f=l.concat(s),p=i,v=t.getCopyOfLocalHistoryArrayFor(p),m=parseInt(f.concat(v).join(""),2);h.predictionTableActive=!0,c&&(p=c.localHistoryIndex,m=c.predictionMachineIndex),u&&!a?m=d:!u&&a&&(m=t.getLocalHistoryValue(p)),a&&t.shiftWithValue(p,r),o(m,r)}function d(e){return angular.copy(h.value[e].bits)}function f(e){var r=h.value[e].bits.join("");return parseInt(r,2)}function p(e){h.value[e].predicted=!1}function v(){h.value=[],h.changed=[],i()}var h={numOfMachines:null,sizeOfMachines:2,value:[],changed:[],predictionTableActive:!1,lastChangedIndex:-1,setMachineSize:i,setPrediction:a,getCurrentPrediction:c,updatePredictions:l,updatePredictionsExceptCorelation:s,getCopyOfMachine:d,getValueOfMachine:f,clear:v,predictionComitted:p};return h}angular.module("app").factory("predictionMachinesService",e),e.$inject=["corelationRegisterService","pcService","localHistoryTableService","speculativeModel"]}();